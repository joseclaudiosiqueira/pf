
var dataFormContrato;$(".money").mask("###0.00",{reverse:true});$("#fmiacon-txt-captcha").on("keyup",function(){verificaCaptcha($(this),$("#fmiacon-i-captcha"),false)});if(empresaConfigPlano.id<3){$("#fmiacon-link").css({"text-decoration":"line-through"})}$("#fmiacon-link").on("click",function(){comboCliente("fmiacon",(isFornecedor?idCliente:0),"1",(isFornecedor?idFornecedor:0));$("#fmiacon_id_cliente").prop("disabled",isFornecedor);if(isFornecedor){atualizaTabelaContratoCliente(idCliente)}$("#fmiacon_btn_inserir").prop("disabled",false);$("#fmiacon_btn_novo").prop("disabled",true);$("#fmiacon_btn_atualizar").prop("disabled",true);$("#fmiacon-img-captcha").attr("src","/pf/vendor/huge/tools/showCaptcha.php")});$("#form_inserir_alterar_contrato").on("submit",function(){var a=$("#fmiacon_acao").val();if($("#fmiacon-txt-captcha").val().length<4){swal({title:"Alerta",text:"As letras da imagem est&atilde;o diferentres do que foi digitado.",type:"error",html:true,confirmButtonText:"Vou corrigir, obrigado!"})}else{if(!($("#fmiacon_tipo").prop("checked"))&&$("#tipo_id_contrato").val()==0){swal({title:"Alerta",text:"Voc&ecirc; selecionou &quot;Aditivo&quot; mas n&atilde;o informou o Contrato.",type:"error",html:true,confirmButtonText:"Vou corrigir, obrigado!"})}else{$.post("/pf/DIM.Gateway.php",variaveisFormContrato(a),function(b){if(b.id>0){swal({title:"Informa&ccedil;&atilde;o",text:b.msg,type:"success",html:true,confirmButtonText:"Obrigado!"});if(dataFormContrato.acao==="inserir"){$("#fmiacon_btn_inserir").prop("disabled",true);$("#fmiacon_btn_novo").prop("disabled",false);$("#fmiacon_btn_atualizar").prop("disabled",false);$("#fmiacon_id").val(b.id);$("#fmiacon_acao").val("alterar")}$("#fmiacon-txt-captcha").val("");$("#fmiacon-img-captcha").attr("src","/pf/vendor/huge/tools/showCaptcha.php");atualizaTabelaContratoCliente($("#fmiacon_id_cliente").val())}else{gravaLogAuditoria(emailLogado,userRole,"inserir-alterar-contrato;"+("000000000"+idEmpresa).slice(-9))}},"json")}}return false});$("#fechar_contrato").on("click",function(){limpaCamposContrato(true);return true});$("#fmiacon_btn_novo").on("click",function(){limpaCamposContrato(false);return true});$("#fmiacon_id_cliente").on("change",function(){limpaCamposContrato(false);atualizaTabelaContratoCliente($(this).val())});$("#fmiacon_tipo").on("change",function(){if(!($(this).prop("checked"))){if($("#addContrato tr").length==0){swal({title:"Alerta",text:"Este cliente ainda n&atilde;o possui contrato(s). Portanto, o primeiro deve ser do tipo [ I ] - Inicial.",type:"error",html:true,confirmButtonText:"Obrigado!"});$("#fmiacon_tipo").bootstrapToggle("on")}else{if($("#addContrato tr").length==1&&$("#fmiacon_acao").val()==="alterar"){swal({title:"Alerta",text:"Este cliente possui apenas um contrato. Portanto, deve ser inicial.",type:"error",html:true,confirmButtonText:"Obrigado!"});$("#fmiacon_tipo").bootstrapToggle("on")}else{$("#tipo_id_contrato").empty().prop("disabled",false);comboContrato($("#fmiacon_id_cliente").val(),"01",0,0,"tipo")}}}else{$("#tipo_id_contrato").empty().prop("disabled",true)}});$("#tipo_id_contrato").on("change",function(){if($(this).val()==$("#fmiacon_id").val()){swal({title:"Aten&ccedil;&atilde;o",text:"O contrato principal n&atilde;o pode ser aditivo dele mesmo.",type:"error",html:true,confirmButtonText:"Obrigado, vou selecionar outro"},function(){$("#tipo_id_contrato").val(0);return false})}});$("#fmiacon_is_ativo").on("change",function(){if(!($(this).prop("checked"))){if($("#addContrato tr").length==0){swal({title:"Aten&ccedil;&atilde;o",text:"Este cliente ainda n&atilde;o possui contrato(s) e voc&ecirc; est&aacute; adicionando o primeiro como INATIVO.",type:"info",html:true,confirmButtonText:"Tem certeza?"});$("#fmiacon_tipo").bootstrapToggle("on")}}});var nowTemp=new Date();var now=new Date(nowTemp.getFullYear(),nowTemp.getMonth(),nowTemp.getDate(),0,0,0,0);var fmiaconDataInicio=$("#fmiacon-data-inicio").datepicker({format:"dd/mm/yyyy",onRender:function(a){}}).on("changeDate",function(a){fmiaconDataInicio.hide();$("#fmiacon-data-fim").val("")[0].focus()}).data("datepicker");var fmiaconDataFim=$("#fmiacon-data-fim").datepicker({format:"dd/mm/yyyy",onRender:function(a){return a.valueOf()<fmiaconDataInicio.date.valueOf()?"disabled":""}}).on("changeDate",function(a){fmiaconDataFim.hide()}).data("datepicker");function atualizaTabelaContratoCliente(a){if(a!=0){iWait("w_fmiacon_id_cliente",true);$.post("/pf/DIM.Gateway.php",{i:a,t:0,arq:66,tch:1,sub:0,dlg:1},function(b){$("#addContrato").empty();for(x=0;x<b.length;x++){addLinhaContrato(b[x].id,b[x].anoNumero,b[x].dataInicio,b[x].dataFim,b[x].tipo,b[x].isAtivo?"on":"off",b[x].valorPF,b[x].valorHpc,b[x].valorHpa)}iWait("w_fmiacon_id_cliente",false);$("#fmiacon_tipo").bootstrapToggle("enable");$("#fmiacon_is_ativo").bootstrapToggle("enable")},"json")}else{$("#tipo_id_contrato").prop("disabled",true);$("#fmiacon_tipo").bootstrapToggle("on");$("#fmiacon_tipo").bootstrapToggle("disable");$("#fmiacon_is_ativo").bootstrapToggle("disable")}}function addLinhaContrato(v,u,s,p,n,l,i,g,d){var e=$("#addContrato").get(0);var j=e.insertRow(-1);var q=j.insertCell(0);var o=j.insertCell(1);var m=j.insertCell(2);var k=j.insertCell(3);var h=j.insertCell(4);var f=j.insertCell(5);var c=j.insertCell(6);var b=j.insertCell(7);var a=l==="on"?"checked":"";q.innerHTML='<a href="#" onclick="exibeContratoAlteracao('+v+');">'+u+"</a>";o.innerHTML=s;m.innerHTML=p;k.innerHTML=n;h.innerHTML='<input onchange="alteraStatusContrato($(this).val(), $(this).prop(\'checked\'));" value="'+v+'" type="checkbox" data-toggle="toggle" data-width="80" data-onstyle="success" data-style="slow" data-on="Ativo" data-off="Inativo" class="datatoggle" '+a+">";f.innerHTML=i;c.innerHTML=g;b.innerHTML=d;$(".datatoggle").bootstrapToggle()}function limpaCamposContrato(a){$("#fmiacon_acao").val("inserir");$("#fmiacon_id").val("");$("#fmiacon_ano").val("");$("#fmiacon_numero").val("");$("#fmiacon-data-inicio").val("");$("#fmiacon-data-fim").val("");$("#fmiacon_pf_contratado").val("");$("#fmiacon_valor_pf").val("");$("#fmiacon_valor_hpc").val("");$("#fmiacon_valor_hpa").val("");$("#fmiacon_tipo").bootstrapToggle("on");$("#fmiacon_is_ativo").bootstrapToggle("on");$("#tipo_id_contrato").empty().prop("disabled",true);$("#fmiacon-txt-captcha").val("");$("#fmiacon-img-captcha").attr("src","/pf/vendor/huge/tools/showCaptcha.php");$("#fmiacon_btn_novo").prop("disabled",true);$("#fmiacon_btn_inserir").prop("disabled",false);$("#fmiacon_btn_atualizar").prop("disabled",true);if(a){$("#addContrato").empty()}$("#fmiacon-i-captcha").removeClass("fa-check-circle").addClass("fa-dot-circle-o");$("#fmiacon_is_ativo").bootstrapToggle("enable");dataFormContrato={}}function variaveisFormContrato(a){dataFormContrato={acao:a,id:$("#fmiacon_id").val(),ano:$("#fmiacon_ano").val(),numero:$("#fmiacon_numero").val(),id_cliente:$("#fmiacon_id_cliente").val(),is_ativo:$("#fmiacon_is_ativo").prop("checked")?1:0,pf_contratado:$("#fmiacon_pf_contratado").val(),valor_pf:$("#fmiacon_valor_pf").val(),data_inicio:$("#fmiacon-data-inicio").val(),data_fim:$("#fmiacon-data-fim").val(),tipo:$("#fmiacon_tipo").prop("checked")?"I":"A",id_primario:!($("#fmiacon_tipo").prop("checked"))?$("#tipo_id_contrato").val():0,valor_hpc:$("#fmiacon_valor_hpc").val(),valor_hpa:$("#fmiacon_valor_hpa").val(),arq:45,tch:0,sub:0,dlg:1};return dataFormContrato}function exibeContratoAlteracao(a){$.post("/pf/DIM.Gateway.php",{i:a,t:1,arq:66,tch:1,sub:0,dlg:1},function(b){$("#fmiacon_acao").val("alterar");$("#fmiacon_id").val(a);$("#fmiacon_ano").val(b[0].ano);$("#fmiacon_numero").val(b[0].numero);$("#fmiacon-data-inicio").val(b[0].dataInicio);$("#fmiacon-data-fim").val(b[0].dataFim);$("#fmiacon_pf_contratado").val(b[0].PFContratado);$("#fmiacon_valor_pf").val(b[0].valorPF);$("#fmiacon_valor_hpc").val(b[0].valorHpc);$("#fmiacon_valor_hpa").val(b[0].valorHpa);$("#fmiacon_tipo").bootstrapToggle(b[0].tipo);if(b[0].tipo==="off"){$("#tipo_id_contrato").empty().prop("disabled",false);comboContrato($("#fmiacon_id_cliente").val(),"01",b[0].idPrimario,1)}$("#fmiacon_is_ativo").bootstrapToggle(b[0].isAtivo);$("#fmiacon_btn_novo").prop("disabled",false);$("#fmiacon_btn_inserir").prop("disabled",true);$("#fmiacon_btn_atualizar").prop("disabled",false);$("#fmiacon_is_ativo").bootstrapToggle("disable")},"json")}function alteraStatusContrato(b,a){iWait("w_contrato_status",true);if($("#fmiacon_id").val()!==""&&$("#fmiacon_id").val()===b){$("#fmiacon_is_ativo").bootstrapToggle("enable").bootstrapToggle(a?"on":"off").bootstrapToggle("disable")}$.post("/pf/DIM.Gateway.php",{i:b,p:a?1:0,arq:34,tch:0,sub:0,dlg:1},function(c){if(!(c.status)){gravaLogAuditoria(emailLogado,userRole,"alterar-status-contrato;"+("000000000"+idEmpresa).slice(-9))}iWait("w_contrato_status",false)},"json")};