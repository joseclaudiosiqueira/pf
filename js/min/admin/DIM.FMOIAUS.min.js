
jQuery(function(a){a(document).on("keypress","input.verifica-id-usuario",function(g){var f=document.getElementById("user_name");var b=(window.event)?event.keyCode:g.which;var c=a("#frmiausu-opcao-identificador").val();var d=a("#user_name").val();if(d.length==11&&c==0){return false}else{if(c==0){if(c==0){if((b>47&&b<58)){return true}else{return(b==8||b==0)?true:false}}}else{if(c==1){if(d.length==64){return false}}}}})});$("#fmiausu-txt-captcha").on("keyup",function(){verificaCaptcha($(this),$("#fmiausu-i-captcha"),false)});$("#fmiausu-link").on("click",function(){formulario="";tpoFornecedor=0;if(empresaConfigPlano.id<3){return false}$("#fmiausu-img-captcha").attr("src","/pf/vendor/huge/tools/showCaptcha.php");$("#span-titulo-usuario").html('&nbsp;&nbsp;<i class="fa fa-users fa-lg"></i>&nbsp;&nbsp;Usu&aacute;rios e Grupos');$("#tip-usuario-fornecedor").html('<i class="fa fa-info-circle"></i>&nbsp;Usu&aacute;rio de um fornecedor?');$("#chk_id_fornecedor").prop("disabled",true).prop("checked",false);_41b053cf7c9e8a38a30fa0fa20b6ea2e3bb16265==="41b053cf7c9e8a38a30fa0fa20b6ea2e3bb16265"?f41b053cf7c9e8a38a30fa0fa20b6ea2e3bb16265():null});$("#fmiaaluno-link").on("click",function(){formulario="turma";tpoFornecedor=1;if(empresaConfigPlano.id<3){return false}$("#fmiausu-img-captcha").attr("src","/pf/vendor/huge/tools/showCaptcha.php");$("#span-titulo-usuario").html('&nbsp;&nbsp;<i class="fa fa-users fa-lg"></i>&nbsp;&nbsp;Usu&aacute;rios e Grupos (Treinamento)');$("#tip-usuario-fornecedor").html('<i class="fa fa-info-circle"></i>&nbsp;Aluno/Instrutor em uma turma?');$("#chk_id_fornecedor").prop("checked",true).prop("disabled",true);comboFornecedores("user",0,"01",formulario==="turma"?1:0,false);_41b053cf7c9e8a38a30fa0fa20b6ea2e3bb16265==="41b053cf7c9e8a38a30fa0fa20b6ea2e3bb16265"?f41b053cf7c9e8a38a30fa0fa20b6ea2e3bb16265():null});$("#user_email").on("keyup",function(){$("#btn-check-email").html('<i class="fa fa-check"></i>&nbsp;Validar').removeClass("btn-success").addClass("btn-default")});$("#chk-opcao-cpf").on("click",function(){$("#frmiausu-opcao-identificador").val("0");$(this).hasClass("btn-default")?$(this).removeClass("btn-default").addClass("btn-success"):null;$("#chk-opcao-outro").removeClass("btn-success").addClass("btn-default");$("#user_name").val("").get(0).focus()});$("#chk-opcao-outro").on("click",function(){$("#frmiausu-opcao-identificador").val("1");$(this).hasClass("btn-default")?$(this).removeClass("btn-default").addClass("btn-success"):null;$("#chk-opcao-cpf").removeClass("btn-success").addClass("btn-default");$("#user_name").val("").get(0).focus()});$("#btn-check-name").on("click",function(){if($("#user_name").val()!==""&&!($("#btn_adicionar_usuario").prop("disabled"))){var a=$("#frmiausu-opcao-identificador").val();iWait("w_user_name",true);$.post("/pf/DIM.Gateway.php",{a:"n",u:$("#user_name").val(),o:a,arq:81,tch:1,sub:4,dlg:1},function(b){if(b[0].existeDimension){$("#user_email").val("").prop("disabled",false).get(0).focus();$("#user_complete_name").val(b[0].user_complete_name).prop("disabled",false);$("#btn-check-name").html('<i class="fa fa-check-circle"></i>&nbsp;Validado').removeClass("btn-default").addClass("btn-success");$("#frmiausu_user_id").val(b[0].user_id);isIDExistente=1;isActive=b[0].user_active;activationHash=b[0].user_activation_hash}else{if(b[0].erro!==""){swal({title:"Alerta",text:b[0].erro,type:"error",html:true,confirmButtonText:"Obrigado, vou corrigir!"},function(){$("#user_name").val("").get(0).focus();$("#btn-check-name").html('<i class="fa fa-check"></i>&nbsp;Validar').removeClass("btn-success").addClass("btn-default");isIDExistente=0;isActive=0;activationHash=""})}else{$("#user_email").val("").prop("disabled",false).get(0).focus();$("#btn-check-name").html('<i class="fa fa-check-circle"></i>&nbsp;Validado').removeClass("btn-default").addClass("btn-success");isIDExistente=0;isActive=0;activationHash=""}}iWait("w_user_name",false)},"json")}else{if($("#user_name").val()===""){swal({title:"Alerta",text:"Por favor, preencha o ID &uacute;nico do usu&aacute;rio ou o CPF.",type:"error",html:true,confirmButtonText:"Obrigado, vou verificar!"},function(){$("#user_name").get(0).focus()});isIDExistente=0;isActive=0;activationHash=""}}});$("#btn-check-email").on("click",function(){if($("#user_email").val()!==""&&!($("#btn_adicionar_usuario").prop("disabled"))){if(validaEmail($("#user_email").val(),$(this))){comboRoles(0,"role_id","w_grupo");$("#chk_id_fornecedor").prop("disabled",formulario==="turma"?true:false).prop("checked",formulario==="turma"?true:false);$("#user_id_fornecedor").prop("disabled",formulario==="turma"?false:true);formulario!=="turma"?comboCliente("user",0,"01",0):null;$("#fmiausu-txt-captcha").prop("disabled",false);$("#btn_inserir_usuario").prop("disabled",false);$("#role_id").prop("disabled",false);$("#user_complete_name").prop("disabled",false).get(0).focus();$("#btn-check-email").html('<i class="fa fa-check-circle"></i>&nbsp;Validado').removeClass("btn-default").addClass("btn-success")}}else{swal({title:"Alerta",text:"Por favor, preencha o email do usu&aacute;rio para que o sistema possa validar.",type:"error",html:true,confirmButtonText:"Obrigado!"})}});$("#user_name").on("keyup",function(){$("#btn-check-name").html('<i class="fa fa-check"></i>&nbsp;Validar').removeClass("btn-success").addClass("btn-default")});$("#form_inserir_usuario").on("submit",function(){if($("#fmiausu-txt-captcha").val().length<4){swal({title:"Alerta",text:"As letras da imagem est&atilde;o diferentes do que foi digitado.",type:"error",html:true,confirmButtonText:"Vou corrigir, obrigado!"});return false}var i=$("#user_name").val();var b=$("#user_email").val();var g=$("#frmiausu_user_id").val();var d=$("#role_id").val();var e=$("#user_complete_name").val();var k=$("#user_id_fornecedor").val();var h=formulario!=="turma"?$("#user_id_cliente").val():0;var c=$("#chk_is_validar_adm_gestor").prop("checked")?1:0;var j=$("#frmiausu-opcao-identificador").val();var a;var f=$("#is-inserir-contagem-auditoria").prop("checked")?1:0;if(d==0){swal({title:"Alerta",text:"Voc&ecirc; precisa associar o <strong>"+(formulario==="turma"?(d==14?"instrutor":"aluno"):"usu&aacute;rio")+"</strong> a um perfil.",type:"error",html:true,confirmButtonText:"Entendi, obrigado!"});return false}if($("#chk_id_fornecedor").prop("checked")&&k==0){swal({title:"Alerta",text:"Voc&ecirc; precisa associar o <strong>"+(formulario==="turma"?(d==14?"instrutor":"aluno"):"usu&aacute;rio")+"</strong> a um"+(formulario==="turma"?"a":"")+(formulario==="turma"?" turma.":" perfil."),type:"error",html:true,confirmButtonText:"Entendi, obrigado!"});return false}$.post("/pf/DIM.Gateway.php",{user_name:i,user_email:b,role_id:d,user_complete_name:e,user_id_fornecedor:k,user_id_cliente:h,user_id:g,is_id_existente:isIDExistente,is_validar_adm_gestor:c,opcao_identificador:j,"41b053cf7c9e8a38a30fa0fa20b6ea2e3bb16265":$("#41b053cf7c9e8a38a30fa0fa20b6ea2e3bb16265").val(),user_active:isActive,user_activation_hash:activationHash,user_is_inserir_contagem_auditoria:f,arq:68,tch:0,sub:4,dlg:1},function(l){if(l[0].msg==="erro"){swal({title:"Alerta",text:"Houve um erro durante a inser&ccedil;&atilde;o do usu&aacute;rio, por favor entre em contato com o Administrador do sistema.",type:"error",html:true,confirmButtonText:"Entendi, obrigado!"})}else{if(l[0].is_id_existente!=0){a="O "+(tpoFornecedor?"aluno":"usu&aacute;rio")+" <strong>"+l[0].user_name+"</strong> foi inserido com um perfil na sua empresa"+(l[0].is_fornecedor?", para "+(formulario==="turma"?"a turma selecionada":"o fornecedor selecionado"):".")}else{a="O "+(tpoFornecedor?"aluno":"usu&aacute;rio")+" <strong>"+l[0].user_name+"</strong> foi inserido com sucesso. As instru&ccedil;&otilde;es de ativa&ccedil;&atilde;o foram enviadas para o email informado."}swal({title:"Informa&ccedil;&atilde;o",text:a,type:"success",html:true,confirmButtonText:"Obrigado!"});limpaCamposUsuario()}},"json");return false});$("#chk_id_fornecedor").on("change",function(){if($(this).prop("checked")){$("#user_id_fornecedor").prop("disabled",false);comboFornecedores("user",0,"01",formulario==="turma"?1:0,false);if($("#role_id").val()==13||$("#role_id").val()==16){$("#user_id_cliente").prop("disabled",false)}}else{$("#user_id_fornecedor").prop("disabled",true).empty().append('<option value="0">...</option>')}});$("#user_id_fornecedor").on("change",function(){$("#role_id").val(0);$.post("/pf/DIM.Gateway.php",{i:$("#user_id_fornecedor").val(),arq:105,tch:1,sub:0,dlg:1},function(a){$("#user_id_cliente").empty().prop("disabled",true);for(x=0;x<a.length;x++){$("#user_id_cliente").append('<option value="'+a[x].id+'">'+a[x].sigla+" - "+a[x].descricao+"</option>")}},"json")});$("#role_id").on("change",function(){if($(this).val()!=0){iWait("w_grupo",true);$.post("/pf/DIM.Gateway.php",{i:$(this).val(),arq:47,tch:1,sub:-1,dlg:1},function(a){$("#addPermission").empty();$("#user_id_cliente").prop("disabled",($("#user_id_fornecedor").val()==0?false:true));if(a.length==0){swal({title:"Alerta",text:"N&atilde;o h&aacute; permiss&otilde;es associadas a este grupo/perfil.",type:"error",html:true,confirmButtonText:"Entendi, obrigado!"});$("#role_id").val(0);$("#chk_is_validar_adm_gestor").prop("disabled",true).prop("checked",false)}else{for(x=0;x<a.length;x++){addLinhaPermission(a[x].ID,a[x].Description,a[x]._Title)}if($("#role_id").val()==1||$("#role_id").val()==7){$("#chk_is_validar_adm_gestor").prop("disabled",(isValidarAdmGestor==1?false:true))}else{$("#chk_is_validar_adm_gestor").prop("disabled",true).prop("checked",false)}if($("#role_id").val()==3||$("#role_id").val()==5||$("#role_id").val()==13||$("#role_id").val()==16){if(formulario==="turma"){swal({title:"Aten&ccedil;&atilde;o",html:true,type:"warning",text:"Estes perfis n&atilde;o podem ser associados a um aluno em turmas de treinamento.",confirmButtonText:"Entendi, obrigado!"},function(){$("#role_id").val(0);$("#addPermission").empty()})}else{if($("#role_id").val()==3||$("#role_id").val()==16){if($("#role_id").val()==3){$.post("/pf/DIM.Gateway.php",{i:$("#user_id_fornecedor").val(),arq:105,tch:1,sub:0,dlg:1},function(b){for(x=0;x<b.length;x++){$("#user_id_cliente").append('<option value="'+b[x].id+'">'+b[x].sigla+" - "+b[x].descricao+"</option>")}},"json")}else{if($("#role_id").val()==16){comboFornecedores("user",0,"01",(formulario==="turma"?1:0),false);$("#chk_id_fornecedor").prop("disabled",false)}}}}}else{$("#user_id_cliente").val(0).prop("disabled",true);$("#chk_id_fornecedor").prop("disabled",false)}}iWait("w_grupo",false)},"json")}else{$("#addPermission").empty();$("#chk_is_validar_adm_gestor").prop("disabled",true).prop("checked",false)}});function addLinhaPermission(c,h,f){var b=$("#addPermission").get(0);var g=b.insertRow(-1);var e=g.insertCell(0);var a=g.insertCell(1);e.setAttribute("align","center");e.innerHTML='<input type="checkbox" name="id_permission" id="id_permission_'+c+'" class="css-checkbox" value="'+c+'" checked disabled /><label for="id_permission_'+c+'" class="css-label-check">&nbsp;</label>';a.innerHTML="<strong>"+f+"</strong>&nbsp;"+h}$("#btn_fechar_usuario").on("click",function(){limpaCamposUsuario()});$("#link_fechar_usuario").on("click",function(){limpaCamposUsuario()});function limpaCamposUsuario(){$("#user_name").val("").prop("disabled",false).get(0).focus();$("#chk-opcao-cpf").removeClass("btn-default").removeClass("btn-success").addClass("btn-success");$("#chk-opcao-outro").removeClass("btn-default").removeClass("btn-success").addClass("btn-default");$("#frmiausu-opcao-identificador").val("0");$("#user_email").val("").prop("disabled",true);$("#frmiau_user_id").val(0);$("#fmiausu-txt-captcha").val("").prop("disabled",true);$("#role_id").empty().prop("disabled",true).append('<option value="0">...</option>');formulario!=="turma"?$("#user_id_fornecedor").empty().prop("disabled",true).append('<option value="0">...</option>'):$("#user_id_fornecedor").prop("disabled",true);formulario!=="turma"?$("#chk_id_fornecedor").prop("disabled",true).prop("checked",false):null;$("#user_id_cliente").empty().prop("disabled",true).append('<option value="0">...</option>');$("#user_complete_name").val("").prop("disabled",true);$("#addPermission").empty();$("#fmiausu-i-captcha").removeClass("fa-check-circle").addClass("fa-dot-circle-o");$("#chk_is_validar_adm_gestor").prop("checked",false).prop("disabled",true);$("#btn-check-name").html('<i class="fa fa-check"></i>&nbsp;Validar').removeClass("btn-success").addClass("btn-default");$("#btn-check-email").html('<i class="fa fa-check"></i>&nbsp;Validar').removeClass("btn-success").addClass("btn-default");if(tpoFornecedor){$("#span-titulo-usuario").html('&nbsp;&nbsp;<i class="fa fa-users fa-lg"></i>&nbsp;&nbsp;Usu&aacute;rios e Grupos (Treinamento)');$("#tip-usuario-fornecedor").html('<i class="fa fa-info-circle"></i>&nbsp;Aluno de uma turma de treinamento?')}else{$("#span-titulo-usuario").html('&nbsp;&nbsp;<i class="fa fa-users fa-lg"></i>&nbsp;&nbsp;Usu&aacute;rios e Grupos')}$("#is-inserir-contagem-auditoria").prop("checked",false);isEmailExistente=0;isIDExistente=0;isActive=0;activationHash="";formulario=formulario!=="turma"?"":"turma"};