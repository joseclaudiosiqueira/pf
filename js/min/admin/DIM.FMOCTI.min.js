
$(".fmocti-link").on("click",function(){var a=Number($("#contagem_id_cliente option:selected").val());if(a>0){$("#col-tabela-2").remove();$("#fmocti-modal").removeClass("modal-lg");$("#fmocti-footer").remove();$("#col-tabela-1").removeClass("col-md-7").addClass("col-md-12");if(ac!=="in"||abAtual==3||abAtual==4){swal({title:"Alerta",text:"Para inserir uma configuração inicial de cadastro de contagens é necessário que seja selecionado o Cliente, ação não pode ser de alteração e a contagem não pode ser Baseline ou Licitação.",type:"warning",html:true});return false}else{$("#form_modal_configuracoes_tab_inicio").modal("show");atualizaTabelaConfiguracoes(a)}}else{if(isFornecedor){comboCliente("fmocti",a,"0",idFornecedor);comboLinguagem("01",0,$("#fmocti_id_linguagem"),a);comboBancoDados("01",0,$("#fmocti_id_banco_dados"),a)}else{comboCliente("fmocti",0,"0",0)}comboTipoContagem("01",0,$("#fmocti_id_tipo_contagem"));comboEtapa("01",0,$("#id_etapa"));comboProcesso("01",0,$("#fmocti_id_processo"));comboEtapa("01",0,$("#fmocti_id_etapa"));comboIndustria("01",0,$("#fmocti_id_industria"));comboProcessoGestao("01",0,$("#fmocti_id_processo_gestao"));$("#form_modal_configuracoes_tab_inicio").modal("show");atualizaTabelaConfiguracoes(0)}});$("#fmocti_id_cliente").on("change",function(){sel=$("#fmo_id_contrato");sel.empty().append('<option value="0">...</option>');sel=$("#fmocti_id_projeto");sel.empty().append('<option value="0">...</option>');if($(this).val()>0){comboContrato($(this).val(),"01",0,0,"fmocti");comboOrgao("01",0,$(this).val(),$("#fmocti_id_orgao"));comboLinguagem("01",0,$("#fmocti_id_linguagem"),$(this).val());comboBancoDados("01",0,$("#fmocti_id_banco_dados"),$(this).val())}});$("#fmocti_id_contrato").on("change",function(){sel=$("#fmocti_id_projeto");sel.empty().append('<option value="0">...</option>');if($(this).val()>0){comboProjeto($(this).val(),"01",0,"fmocti")}});$("#btn-adicionar-configuracao-tab-inicio").on("click",function(){var i=$("#fmocti_id_cliente option:selected").val();var e=$("#fmocti_id_contrato option:selected").val();var f=$("#fmocti_id_projeto option:selected").val();var n=$("#fmocti_id_orgao option:selected").val();var j=$("#fmocti_ordem_servico").val();var a=$("#fmocti_id_linguagem option:selected").val();var m=$("#fmocti_id_banco_dados option:selected").val();var k=$("#fmocti_id_tipo_contagem option:selected").val();var c=$("#fmocti_id_etapa option:selected").val();var d=$("#fmocti_id_industria option:selected").val();var b=$("#fmocti_id_processo option:selected").val();var l=$("#fmocti_id_processo_gestao option:selected").val();var h=$("#fmocti_proposito").val();var g=$("#fmocti_escopo").val();if(i==0||e==0||f==0||n==0||a==0||m==0||k==0||c==0||d==0||b==0||l==0){swal({title:"Alerta",text:"Para inserir uma configuração inicial de cadastro de contagens, todos os campos são <strong>obrigatórios</strong>",type:"error",html:true})}else{$.post("/pf/DIM.Gateway.php",{idf:isFornecedor?idFornecedor:0,idc:i,idr:e,idj:f,ido:n,ors:j,idl:a,idb:m,idt:k,ide:c,idi:d,idp:b,idg:l,pro:h,esc:g,arq:91,tch:0,sub:0,dlg:0},function(o){if(o.sucesso){swal({title:"Informação",text:o.msg,type:"success",html:true});atualizaTabelaConfiguracoes(0)}else{swal({title:"Alerta",text:o.msg,type:"error",html:true})}},"json")}});function atualizaTabelaConfiguracoes(a){$.post("/pf/DIM.Gateway.php",{idc:a,arq:96,tch:1,sub:0,dlg:1},function(e){var g=$("#addConfiguracoesTabInicio").empty().get(0);var f;for(x=0;x<e.length;x++){f=g.insertRow(-1);var d=f.insertCell(0);var c=f.insertCell(1);var b=f.insertCell(2);if($("#contagem_id_cliente").length>0){d.setAttribute("width","45%");c.setAttribute("width","45%");b.setAttribute("width","10%")}else{d.setAttribute("width","35%");c.setAttribute("width","55%");b.setAttribute("width","10%")}d.setAttribute("align","center");d.innerHTML=e[x].linguagem+'&nbsp;<i class="fa fa-plus-circle fa-lg"></i>&nbsp;'+e[x].bancoDados+'&nbsp;<i class="fa fa-plus-circle fa-lg"></i>&nbsp;'+e[x].gestao;c.innerHTML="[<strong>Cliente</strong>: "+e[x].cliente+"] [<strong>Contrato</strong>: "+e[x].contrato+"] [<strong>Projeto</strong>: "+e[x].projeto+"] [<strong>Órgão</strong>: "+e[x].orgao+"] [<strong>Banco de Dados</strong>: "+e[x].bancoDadosDescricao+"] [<strong>Ordem de Serviço</strong>: "+e[x].ordemServico+"] [<strong>Tipo de contagem</strong>: "+e[x].tipo+"] [<strong>Etapa</strong>: "+e[x].etapa+"] [<strong>Área de atuação</strong>: "+e[x].atuacao+"] [<strong>Processo</strong>: "+e[x].processo+"]";b.innerHTML=$("#contagem_id_cliente").length>0?'<button type="button" class="btn btn-success btn-block" onclick="alteraIdsTabInicio('+e[x].id+');"><i class="fa fa-check-circle"></i>&nbsp;Utilizar</button>':'<button type="button" class="btn btn-warning btn-block" onclick="excluirLinhaConfiguracao('+e[x].id+');"><i class="fa fa-trash"></i>&nbsp;Excluir</button>'}},"json")}function excluirLinhaConfiguracao(a){swal({title:"Tem certeza?",text:"Ap&oacute;s a exclus&atilde;o da linha as informa&ccedil;&otilde;es n&atilde;o poder&atilde;o ser recuperadas",type:"warning",html:true,showCancelButton:true,cancelButtonText:"Cancelar",confirmButtonColor:"#DD6B55",confirmButtonText:"Sim",closeOnConfirm:true},function(){$.post("/pf/DIM.Gateway.php",{idc:a,arq:92,tch:0,sub:0,dlg:0},function(b){if(b.sucesso){atualizaTabelaConfiguracoes(0);return true}},"json")})}function alteraIdsTabInicio(a){$.post("/pf/DIM.Gateway.php",{idc:a,arq:97,tch:1,sub:0,dlg:0},function(b){$("#contagem_id_contrato option[value='"+b.id_contrato+"']").attr("selected","selected");getValorHora(b.id_contrato);if(Number(isContagemAuditoria)==1){comboProjeto(b.id_contrato,"01",b.id_projeto,"contagem",1)}else{comboProjeto(b.id_contrato,"01",b.id_projeto,"contagem")}getGerenteProjeto(b.id_projeto);$("#id-orgao").val(b.id_orgao).change();$("#ordem_servico").val(b.ordem_servico);$("#id_linguagem").val(b.id_linguagem).change();$("#id_tipo_contagem").val(b.id_tipo).change();$("#id_banco_dados").val(b.id_banco_dados).change();$("#id_industria").val(b.id_area_atuacao).change();$("#id_processo").val(b.id_processo).change();$("#id_processo_gestao").val(b.id_processo_gestao).change();$("#id_etapa").val(b.id_etapa).change();idEtapa=b.id_etapa;if(b.id_etapa==3){$("#li-ee").addClass("disabled");$("#li-se").addClass("disabled");$("#li-ce").addClass("disabled");$("#li-ou").addClass("disabled");$("#btn-pesquisar-ali").prop("disabled",true);$("#btn-pesquisar-aie").prop("disabled",true);$("#btn_adicionar_ali").prop("disabled",true);$("#btn_adicionar_aie").prop("disabled",true)}else{$("#li-ee").removeClass("disabled");$("#li-se").removeClass("disabled");$("#li-ce").removeClass("disabled");$("#li-ou").removeClass("disabled");$("#btn-pesquisar-ali").prop("disabled",false);$("#btn-pesquisar-aie").prop("disabled",false);$("#btn_adicionar_ali").prop("disabled",false);$("#btn_adicionar_aie").prop("disabled",false)}$("#proposito").val(b.proposito);$("#escopo").val(b.escopo)},"json");$("#form_modal_configuracoes_tab_inicio").modal("hide")};