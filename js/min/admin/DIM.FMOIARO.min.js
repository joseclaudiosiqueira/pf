
var dataFormRoteiro;var fmiar_idCliente=0;var fmiar_idFornecedor=0;var fmiar_exclusivo_isCliente=false;var fmiar_exclusivo_isFornecedor=false;$("#fmiar-txt-captcha").on("keyup",function(){verificaCaptcha($(this),$("#fmiar-i-captcha"),false)});$("#fmiar_observacoes").charCount({allowed:2000,warning:100});$("#href_modal_roteiro").on("click",function(){atualizaTabelaRoteiro();$("#fmiar-img-captcha").attr("src","/pf/vendor/huge/tools/showCaptcha.php")});$("#fmiar_is_exclusivo").on("change",function(){if($(this).prop("checked")){$("#chk_roteiro_exclusivo_1").prop("disabled",false).prop("checked",false);$("#chk_roteiro_exclusivo_2").prop("disabled",false).prop("checked",false);$("#fmiar_is_compartilhado").bootstrapToggle("off").bootstrapToggle("disable")}else{$("#chk_roteiro_exclusivo_1").prop("disabled",true).prop("checked",false);$("#chk_roteiro_exclusivo_2").prop("disabled",true).prop("checked",false);$("#fmiar_is_compartilhado").bootstrapToggle("enable");$("#generico_id_cliente").empty().prop("disabled",true);$("#generico_id_fornecedor").empty().prop("disabled",true)}});$("#chk_roteiro_exclusivo_1").on("click",function(){$("#generico_id_fornecedor").empty().prop("disabled",true);$("#generico_id_cliente").prop("disabled",false);comboCliente("generico",0,0,0)});$("#chk_roteiro_exclusivo_2").on("click",function(){$("#generico_id_cliente").empty().prop("disabled",true);$("#generico_id_fornecedor").prop("disabled",false);comboFornecedores("generico",0,0,0,true)});$("#fmiar_descricao").on("change",function(){iWait("w_fmiar_descricao",true);$.post("/pf/DIM.Gateway.php",{d:$(this).val(),arq:67,tch:1,sub:0,dlg:1},function(a){if(a.length>0){swal({title:"Informa&ccedil;&atilde;o",text:"J&aacute; existe(m) algum(s) roteiro(s) com esta sigla.",type:"info",html:true,confirmButtonText:"Obrigado pela dica!"})}iWait("w_fmiar_descricao",false)},"json")});$("#fmiar_btn_novo").on("click",function(){limpaCamposRoteiro()});$("#fechar_roteiro").on("click",function(){limpaCamposRoteiro()});$("#form_inserir_alterar_roteiro").on("submit",function(){if(variaveisFormRoteiro($("#fmiar_acao").val())){$.post("/pf/DIM.Gateway.php",dataFormRoteiro,function(a){if(a.id>0){swal({title:"Informa&ccedil;&atilde;o",text:a.msg,type:"success",html:true,confirmButtonText:"Obrigado!"});if(dataFormRoteiro.acao==="inserir"){$("#fmiar_btn_inserir").prop("disabled",true);$("#fmiar_btn_novo").prop("disabled",false);$("#fmiar_btn_atualizar").prop("disabled",false);$("#fmiar_id").val(a.id);$("#fmiar_acao").val("alterar")}fmiar_exclusivo_isCliente=false;fmiar_exclusivo_isFornecedor=false;$("#fmiar-img-captcha").attr("src","/pf/vendor/huge/tools/showCaptcha.php");$("#fmiar-txt-captcha").val("");atualizaTabelaRoteiro()}},"json")}return false});function atualizaTabelaRoteiro(){iWait("w_id_roteiro",false);$.post("/pf/DIM.Gateway.php",{i:idEmpresa,t:0,arq:64,tch:1,sub:0,dlg:1},function(a){$("#addRoteiro").empty();for(x=0;x<a.length;x++){addLinhaRoteiro(a[x].id,a[x].descricao,a[x].observacoes,a[x].is_ativo,a[x].tipo,a[x].descricao_roteiro_importado,a[x].id_empresa,a[x].id_fornecedor,a[x].id_cliente)}iWait("w_id_roteiro",false);$("#fmiar_is_ativo").bootstrapToggle("enable");$("#fmiar_tipo").bootstrapToggle("enable")},"json")}function addLinhaRoteiro(u,s,q,o,k,i,f,e,c){var d=$("#addRoteiro").get(0);var g=d.insertRow(-1);var p=g.insertCell(0);var n=g.insertCell(1);var j=g.insertCell(2);var h=g.insertCell(3);var b=o==="on"?"checked":"";var v=k==="on"?"checked":"";var m=(f==0&&idEmpresa!=1)?"disabled":"";var a=(u==3)?"disabled":"";var l=((e>0||c>0)||(f==0&&idEmpresa!=1))?"disabled":"";p.setAttribute("nowrap","nowrap");p.innerHTML=(f==0&&idEmpresa!=1)?s:'<a href="#" onclick="exibeRoteiroAlteracao('+u+');">'+s+"</a>";n.innerHTML=q;j.innerHTML='<input onchange="alteraStatusRoteiro($(this).val(), $(this).prop(\'checked\'));" value="'+u+'" type="checkbox" data-toggle="toggle" data-width="80" data-height="36" data-onstyle="success" data-style="slow" data-on="Ativo" data-off="Inativo" class="datatoggle" '+b+" "+m+" "+a+">";h.innerHTML='<input onchange="alteraTipoRoteiro($(this).val(), $(this).prop(\'checked\'));" value="'+u+'" type="checkbox" data-toggle="toggle" data-width="80" data-height="36" data-onstyle="warning" data-style="slow" data-on="P&uacute;blico" data-off="Privado" class="datatoggle" '+v+" "+l+">";$(".datatoggle").bootstrapToggle()}function alteraStatusRoteiro(b,a){iWait("w_roteiro_status",true);if($("#fmiar_id").val()!==""&&$("#fmiar_id").val()===b){$("#fmiar_is_ativo").bootstrapToggle("enable").bootstrapToggle(a?"on":"off").bootstrapToggle("disable")}$.post("/pf/DIM.Gateway.php",{i:b,p:a?1:0,arq:36,tch:0,sub:0,dlg:1},function(c){iWait("w_roteiro_status",false)},"json")}function alteraTipoRoteiro(b,a){iWait("w_roteiro_tipo",true);if($("#fmiar_id").val()!==""&&$("#fmiar_id").val()===b){$("#fmiar_tipo").bootstrapToggle("enable").bootstrapToggle(a?"on":"off").bootstrapToggle("disable")}$.post("/pf/DIM.Gateway.php",{i:b,t:a?1:0,arq:37,tch:0,sub:0,dlg:1},function(c){iWait("w_roteiro_tipo",false)},"json")}function variaveisFormRoteiro(a){if($("#fmiar-txt-captcha").val().length<4){swal({title:"Alerta",text:"As letras da imagem est&atilde;o diferentres do que foi digitado.",type:"error",html:true,confirmButtonText:"Vou corrigir, obrigado!"});return false}if($("#fmiar_is_exclusivo").prop("checked")){if($("#chk_roteiro_exclusivo_1").prop("checked")&&$("#generico_id_cliente").val()==0){swal({title:"Alerta",text:"Voc&ecirc; selecionou roteiro exclusivo mas n&atilde;o selecionou um Cliente.",type:"error",html:true,confirmButtonText:"Vou verificar, obrigado!"});return false}else{fmiar_exclusivo_isCliente=true;fmiar_idCliente=$("#generico_id_cliente").val()}if($("#chk_roteiro_exclusivo_2").prop("checked")&&$("#generico_id_fornecedor").val()==0){swal({title:"Alerta",text:"Voc&ecirc; selecionou roteiro exclusivo mas n&atilde;o selecionou um Fornecedor.",type:"error",html:true,confirmButtonText:"Vou verificar, obrigado!"});return false}else{fmiar_exclusivo_isFornecedor=true;fmiar_idFornecedor=$("#generico_id_fornecedor").val()}}dataFormRoteiro={acao:a,id:$("#fmiar_id").val(),descricao:$("#fmiar_descricao").val(),observacoes:$("#fmiar_observacoes").val(),is_exclusivo:$("#fmiar_is_exclusivo").prop("checked")?1:0,id_cliente:fmiar_exclusivo_isCliente?fmiar_idCliente:0,id_fornecedor:fmiar_exclusivo_isFornecedor?fmiar_idFornecedor:0,is_ativo:$("#fmiar_is_ativo").prop("checked")?1:0,is_compartilhado:$("#fmiar_is_compartilhado").prop("checked")?1:0,id_roteiro_importado:0,arq:49,tch:0,sub:0,dlg:1};return true}function exibeRoteiroAlteracao(a){$.post("/pf/DIM.Gateway.php",{i:a,t:1,arq:64,tch:1,sub:0,dlg:1},function(b){$("#fmiar_acao").val("alterar");$("#fmiar_id").val(a);$("#fmiar_descricao").val(b[0].descricao);$("#fmiar_observacoes").val(b[0].observacoes);$("#fmiar_is_exclusivo").bootstrapToggle(b[0].is_exclusivo);if(b[0].roteiros_utilizacao){$("#fmiar_is_exclusivo").bootstrapToggle("disable");$("#generico_id_cliente").prop("disabled",true);$("#generico_id_fornecedor").prop("disabled",true);$("#chk_roteiro_exclusivo_1").prop("disabled",true);$("#chk_roteiro_exclusivo_2").prop("disabled",true)}else{if(b[0].is_exclusivo==="on"){$("#fmiar_is_exclusivo").bootstrapToggle(b[0].is_exclusivo);if(b[0].id_cliente>0){comboCliente("generico",b[0].id_cliente,0,0);$("#generico_id_cliente").prop("disabled",false);$("#generico_id_fornecedor").prop("disabled",true).empty();$("#chk_roteiro_exclusivo_1").prop("checked",true)}else{if(b[0].id_fornecedor>0){comboFornecedores("generico",b[0].id_fornecedor,0,true);$("#generico_id_fornecedor").prop("disabled",false);$("#generico_id_cliente").prop("disabled",true).empty();$("#chk_roteiro_exclusivo_2").prop("checked",true)}}}}$("#fmiar_is_ativo").bootstrapToggle(b[0].is_ativo);(a==3)?$("#fmiar_is_ativo").bootstrapToggle("disable"):$("#fmiar_is_ativo").bootstrapToggle("enable");$("#fmiar_is_compartilhado").bootstrapToggle(b[0].tipo);$("#fmiar_btn_novo").prop("disabled",false);$("#fmiar_btn_inserir").prop("disabled",true);$("#fmiar_btn_atualizar").prop("disabled",false)},"json")}function limpaCamposRoteiro(){$("#fmiar_descricao").val("").get(0).focus();$("#fmiar_observacoes").val("");$("#fmiar_is_exclusivo").bootstrapToggle("enable").bootstrapToggle("off");$("#fmiar_is_ativo").bootstrapToggle("on").bootstrapToggle("enable");$("#fmiar_is_compartilhado").bootstrapToggle("enable").bootstrapToggle("off");$("#fmiar_btn_novo").prop("disabled",false);$("#fmiar_btn_inserir").prop("disabled",false);$("#fmiar_btn_atualizar").prop("disabled",true);$("#fmiar_id").val(0);$("#fmiar_acao").val("inserir");dataFormRoteiro=[];fmiar_idCliente=0;fmiar_idFornecedor=0;fmiar_exclusivo_isCliente=false;fmiar_exclusivo_isFornecedor=false;$("#fmiar-img-captcha").attr("src","/pf/vendor/huge/tools/showCaptcha.php");$("#fmiar-txt-captcha").val("")}function habilitaDesabilitaBotoes(){$("#fmiar_btn_novo").prop("disabled",false);$("#fmiar_btn_inserir").prop("disabled",true);$("#fmiar_btn_atualizar").prop("disabled",false)};