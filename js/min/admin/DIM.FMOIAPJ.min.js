
if(empresaConfigPlano.id<3){$("#fmiapro-link").css({"text-decoration":"line-through"})}$("#fmiapro-link").on("click",function(){comboGerenteProjeto(0);var a=$("#prj_id_gerente_projeto").get(0);if(a.length==0){$(a).prop("disabled",true)}$("#fmiapro-img-captcha").attr("src","/pf/vendor/huge/tools/showCaptcha.php");comboCliente("prj",(isFornecedor?idCliente:0),0,(isFornecedor?idFornecedor:0));$("#prj_id_cliente").prop("disabled",isFornecedor);if(isFornecedor){comboContrato(idCliente,"0",0,0,"prj");$("#prj_id_contrato").prop("disabled",false)}});var nowTemp=new Date();var now=new Date(nowTemp.getFullYear(),nowTemp.getMonth(),nowTemp.getDate(),0,0,0,0);var checkin=$("#prj_data_inicio").datepicker({format:"dd/mm/yyyy",onRender:function(a){}}).on("changeDate",function(a){checkin.hide();$("#prj_data_fim").val("")[0].focus()}).data("datepicker");var checkout=$("#prj_data_fim").datepicker({format:"dd/mm/yyyy",onRender:function(a){return a.valueOf()<checkin.date.valueOf()?"disabled":""}}).on("changeDate",function(a){checkout.hide()}).data("datepicker");var dataFormProjeto;$("#fmiapro-txt-captcha").on("keyup",function(){verificaCaptcha($(this),$("#fmiapro-i-captcha"),false)});$("#prj_id_cliente").on("change",function(){if($(this).val()>0){$("#prj_id_contrato").prop("disabled",false);comboContrato($(this).val(),"0",0,0,"prj")}else{limpaCamposProjeto(true)}});$("#prj_id_contrato").on("change",function(){if($(this).val()>0){$("#prj_id_contrato").prop("disabled",false);$("#prj_btn_inserir").prop("disabled",false);$("#prj_btn_novo").prop("disabled",true);$("#prj_btn_atualizar").prop("disabled",true)}else{$("#addProjeto").empty();limpaCamposProjeto(false)}});$("#form_inserir_alterar_projeto").on("submit",function(){dataPost=variaveisFormProjeto($("#prj_acao").val());if($("#fmiapro-txt-captcha").val().length<4){swal({title:"Alerta",text:"As letras da imagem est&atilde;o diferentres do que foi digitado.",type:"error",html:true,confirmButtonText:"Vou corrigir, obrigado!"})}else{if($("#prj_id_contrato").val()==null||$("#prj_id_contrato").val()==0){swal({title:"Alerta",text:"Voc&ecirc; deve selecionar um contrato ou ter no m&iacute;nimo um ativo. Entre em contato com o administrador do sistema.",type:"error",html:true,confirmButtonText:"Vou verificar, obrigado!"})}else{if(!($("#prj_id_gerente_projeto").prop("disabled"))&&$("#prj_id_gerente_projeto").val()<1){swal({title:"Alerta",text:"Voc&ecirc; deve inserir um gerente para o projeto.",type:"error",html:true,confirmButtonText:"Vou verificar, obrigado!"})}else{$.post("/pf/DIM.Gateway.php",dataPost,function(a){if(a.id>0){swal({title:"Informa&ccedil;&atilde;o",text:a.msg,type:"success",html:true,confirmButtonText:"Obrigado!"});if(dataPost.acao==="inserir"){$("#prj_btn_inserir").prop("disabled",true);$("#prj_btn_novo").prop("disabled",false);$("#prj_btn_atualizar").prop("disabled",false);$("#prj_id").val(a.id);$("#prj_acao").val("alterar")}$("#prj_img_captcha").attr("src","/pf/vendor/huge/tools/showCaptcha.php");$("#prj_captcha").val("");atualizaTabelaProjetoContrato($("#prj_id_contrato").val())}},"json")}}}return false});$("#fechar_projeto").on("click",function(){limpaCamposProjeto(true);return true});$("#prj_btn_fechar").on("click",function(){limpaCamposProjeto(true);return true});$("#prj_btn_novo").on("click",function(){limpaCamposProjeto(false);return true});$("#prj_id_contrato").on("change",function(){limpaCamposProjeto(false);atualizaTabelaProjetoContrato($(this).val())});function atualizaTabelaProjetoContrato(a){if(a!=0){iWait("w_id_contrato",true);$.post("/pf/DIM.Gateway.php",{i:a,t:0,arq:70,tch:1,sub:0,dlg:1},function(b){$("#addProjeto").empty();for(x=0;x<b.length;x++){addLinhaProjeto(b[x].id,b[x].isAtivo,b[x].dataInicio,b[x].dataFim,b[x].descricao)}iWait("w_id_projeto",false);$("#prj_is_ativo").bootstrapToggle("enable")},"json")}}function addLinhaProjeto(i,g,e,d,c){var l=$("#addProjeto").get(0);var a=l.insertRow(-1);var k=a.insertCell(0);var j=a.insertCell(1);var h=a.insertCell(2);var f=a.insertCell(3);var b=g==="on"?"checked":"";k.innerHTML='<a href="#" onclick="exibeProjetoAlteracao('+i+');">'+c+"</a>";j.innerHTML=e;h.innerHTML=d;f.innerHTML='<input onchange="alteraStatusProjeto($(this).val(), $(this).prop(\'checked\'));" value="'+i+'" type="checkbox" data-toggle="toggle" data-width="80" data-onstyle="success" data-style="slow" data-on="Ativo" data-off="Inativo" class="datatoggle" '+b+">";$(".datatoggle").bootstrapToggle()}function limpaCamposProjeto(a){$("#prj_acao").val("inserir");$("#prj_id").val("");$("#prj_descricao").val("");$("#prj_data_inicio").val("");$("#prj_data_fim").val("");$("#prj_is_ativo").bootstrapToggle("on");$("#prj_btn_novo").prop("disabled",true);$("#prj_btn_inserir").prop("disabled",false);$("#prj_btn_atualizar").prop("disabled",true);$("#prj_id_gerente_projeto").val(0);if(a){$("#prj_captcha").val("");$("#fmiapro-img-captcha").attr("src","/pf/vendor/huge/tools/showCaptcha.php");$("#fmiapro-i-captcha").removeClass("fa-check-circle").addClass("fa-dot-circle-o");$("#addProjeto").empty();$("#prj_id_contrato").empty().prop("disabled",true);$("#prj_id_cliente").val(0)}dataFormProjeto={}}function variaveisFormProjeto(a){dataFormProjeto={acao:a,id_contrato:$("#prj_id_contrato").val(),id:$("#prj_id").val(),descricao:$("#prj_descricao").val(),is_ativo:$("#prj_is_ativo").prop("checked")?1:0,data_inicio:$("#prj_data_inicio").val(),data_fim:$("#prj_data_fim").val(),id_gerente_projeto:$("#prj_id_gerente_projeto").prop("disabled")?0:$("#prj_id_gerente_projeto").val(),arq:48,tch:0,sub:0,dlg:1};return dataFormProjeto}function exibeProjetoAlteracao(a){$.post("/pf/DIM.Gateway.php",{i:a,t:1,arq:70,tch:1,sub:0,dlg:1},function(b){$("#prj_acao").val("alterar");$("#prj_id").val(a);$("#prj_descricao").val(b[0].descricao);$("#prj_data_inicio").val(b[0].dataInicio);$("#prj_data_fim").val(b[0].dataFim);$("#prj_is_ativo").bootstrapToggle(b[0].isAtivo);$("#prj_btn_novo").prop("disabled",false);$("#prj_btn_inserir").prop("disabled",true);$("#prj_btn_atualizar").prop("disabled",false);$("#prj_id_gerente_projeto").val(b[0].idGerenteProjeto)},"json")}function alteraStatusProjeto(b,a){iWait("w_projeto_status",true);if($("#prj_id").val()!==""&&$("#prj_id").val()===b){$("#prj_is_ativo").bootstrapToggle("enable").bootstrapToggle(a?"on":"off").bootstrapToggle("disable")}$.post("/pf/DIM.Gateway.php",{i:b,p:a?1:0,arq:73,tch:0,sub:0,dlg:1},function(c){if(!(c.status)){gravaLogAuditoria(emailLogado,userRole,"alterar-status-projeto;"+("000000000"+idEmpresa).slice(-9))}iWait("w_projeto_status",false)},"json")};