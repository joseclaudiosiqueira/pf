
$("#perfil-txt-captcha").on("keyup",function(){verificaCaptcha($(this),$("#perfil-i-captcha"),false)});$("#link_modal_gerenciar_perfis").on("click",function(){$("#title-gerenciar-perfis").html("&nbsp;&nbsp;Gerenciamento de perfis de usu&aacute;rios");$.post("/pf/DIM.Gateway.php",{arq:77,tch:1,sub:4,dlg:1},function(a){for(x=0;x<a.length;x++){addLinhaPerfil(a[x].eSigla,a[x].fSigla,a[x].id_empresa,a[x].id_fornecedor,a[x].is_ativo,a[x].user_complete_name,a[x].user_email,a[x].user_id,a[x].RoleId,a[x].short_name,a[x].Title,a[x].is_validar_adm_gestor,a[x].id_cliente)}},"json");$("#perfil-img-captcha").attr("src","/pf/vendor/huge/tools/showCaptcha.php")});$("#link_modal_gerenciar_perfis_alunos").on("click",function(){$("#title-gerenciar-perfis").html("&nbsp;&nbsp;Gerenciamento de perfis de alunos");$.post("/pf/DIM.Gateway.php",{tipo:1,arq:77,tch:1,sub:4,dlg:1},function(a){for(x=0;x<a.length;x++){addLinhaPerfil(a[x].eSigla,a[x].fSigla,a[x].id_empresa,a[x].id_fornecedor,a[x].is_ativo,a[x].user_complete_name,a[x].user_email,a[x].user_id,a[x].RoleId,a[x].short_name,a[x].Title,a[x].is_validar_adm_gestor,a[x].id_cliente)}},"json");$("#perfil-img-captcha").attr("src","/pf/vendor/huge/tools/showCaptcha.php")});$("#perfil_btn_cancelar").on("click",function(){limpaCamposPerfil(false)});$("#fechar_perfil").on("click",function(){limpaCamposPerfil(true)});$("#select_role_id").on("change",function(){if($(this).val()!=0){iWait("w_perfil_grupo",true);$.post("/pf/DIM.Gateway.php",{i:$(this).val(),arq:47,tch:1,sub:-1,dlg:1},function(a){if(a.length==0){swal({title:"Alerta",text:"N&atilde;o h&aacute; permiss&otilde;es associadas a este grupo/perfil.",type:"error",html:true,confirmButtonText:"Entendi, obrigado!"});$("#select_role_id").val(0);$("#perfil_btn_atualizar").prop("disabled",true);$("#chk_is_validar_adm_gestor_perfil").prop("disabled",true).prop("checked",false)}iWait("w_perfil_grupo",false)},"json")}if(Number($("#user_role_id").val())!=Number($(this).val())&&$(this).val()!=0){$("#perfil_btn_atualizar").prop("disabled",false)}else{$("#perfil_btn_atualizar").prop("disabled",true)}if($("#select_role_id").val()==1||$("#select_role_id").val()==7){$("#chk_is_validar_adm_gestor_perfil").prop("disabled",false)}else{$("#chk_is_validar_adm_gestor_perfil").prop("disabled",true).prop("checked",false)}});$("#chk_is_validar_adm_gestor_perfil").on("change",function(){$("#perfil_btn_atualizar").prop("disabled",!1)});$("#form_gerenciar_perfis").on("submit",function(){var d=$("#user_id_user").val();var h=$("#user_id_empresa").val();var g=$("#user_id_fornecedor_perfil").val();var a=$("#select_role_id").val();var o=$("#user_role_title").val();var m=$("#chk_is_validar_adm_gestor_perfil").prop("checked")?1:0;var c=$("#span_user_name").html().replace("&nbsp;","").replace("(","").replace(")","");var p=$("#user_short_name").val();var l,b,j,k;if($("#perfil-txt-captcha").val().length<4){swal({title:"Alerta",text:"As letras da imagem est&atilde;o diferentres do que foi digitado.",type:"error",html:true,confirmButtonText:"Vou corrigir, obrigado!"});return false}if(a==0){swal({title:"Alerta",text:"Voc&ecirc; precisa associar o usu&aacute;rio a um perfil.",type:"error",html:true,confirmButtonText:"Entendi, obrigado!"});return false}$.post("/pf/DIM.Gateway.php",{i:d,e:h,f:g,r:a,t:o,v:m,j:"action.alterar.perfil.usuario",su:"user"},function(e){if(e.status){l="Informa&ccedil;&atilde;o";b="O perfil do usu&aacute;rio foi alterado com sucesso.";j="info";k="Obrigado!";alteraSpanRoleTitle(d,e.short_name);alteraSpanIsValidar(d,m);alteraClickExibirPerfil(a,d,h,g,o,p,c,m)}else{l="Alerta";b="O sistema n&atilde;o conseguiu alterar o perfil do usu&aacute;rio. Favor entrar em contato com o administrador.";j="error";k="Vou verificar, obrigado!"}swal({title:l,text:b,type:j,html:true,confirmButtonText:k})},"json");limpaCamposPerfil(false);return false});function addLinhaPerfil(z,w,u,q,o,m,j,h,e,B,A,y,v){var f=$("#addUsuario").get(0);var k=f.insertRow(-1);var s=k.insertCell(0);var p=k.insertCell(1);var n=k.insertCell(2);var l=k.insertCell(3);var i=k.insertCell(4);var g=k.insertCell(5);var d=k.insertCell(6);var c=o==1?"checked":"";var a=(j===emailLogado||empresaConfigPlano.id<3)?"disabled":"";var b=j.split("@");s.innerHTML=(j===emailLogado||empresaConfigPlano.id<3)?"#"+("000000"+h).slice(-6):'<span id="l'+("000000"+h).slice(-6)+'"><a href="#" id="click_'+("000000"+h).slice(-6)+'" onclick="exibePerfilAlteracao('+e+", "+h+", "+u+", "+q+", '"+A+"', '"+B+"', '"+m+"', '"+y+"');\">#"+("000000"+h).slice(-6)+"</a></span>";p.innerHTML='<span id="is_v_'+("000000"+h).slice(-6)+'">'+(1==y?'<font style="color:#000;"><i class="fa fa-check-circle-o fa-lg"></i>&nbsp;</font>':'<font style="color:#d0d0d0;"><i class="fa fa-minus-circle fa-lg"></i>&nbsp;</font>')+"</span>"+m;n.innerHTML='<a href="mailto:'+j+'">'+b[0]+"@</a>";l.innerHTML=q==0?'<span class="label label-info"> E </span>&nbsp;'+z:'<span class="label label-default"> F </span>&nbsp;'+w;i.innerHTML='<span id="u'+("000000"+h).slice(-6)+'">'+B+"</span>";g.innerHTML=v==0?"-":v;d.innerHTML="<input onchange=\"alteraStatusUsuario($(this).val(), $(this).prop('checked'), "+u+", "+q+');" value="'+h+'" type="checkbox" data-toggle="toggle" data-size="mini" data-width="70" data-onstyle="success" data-style="slow" data-on="Ativo" data-off="Inativo" class="datatoggle" '+c+" "+a+">";$(".datatoggle").bootstrapToggle()}function alteraStatusUsuario(a,d,c,b){iWait("w_usuario_status",true);$.post("/pf/DIM.Gateway.php",{i:a,p:d?1:0,e:c,f:b,arq:66,tch:0,sub:4,dlg:1},function(){iWait("w_usuario_status",false)},"json")}function exibePerfilAlteracao(g,c,j,h,b,d,k,a){if($("#select_role_id").prop("disabled")){comboRoles(g,"select_role_id","w_perfil_grupo")}else{$("#select_role_id option[value="+g+"]").prop("selected",!0)}$("#select_role_id").prop("disabled",!1);$("#user_id_user").val(c);$("#user_id_empresa").val(j);$("#user_id_fornecedor_perfil").val(h);$("#user_role_title").val(b);$("#user_short_name").val(d);$("#user_role_id").val(g);$("#perfil-txt-captcha").val("");$("#span_user_name").html("&nbsp;(<strong>"+k+"</strong>)");$("#perfil_btn_cancelar").prop("disabled",!1);$("#chk_is_validar_adm_gestor_perfil").prop("checked",1==a?!0:!1).prop("disabled",1==g||7==g?!1:!0)}function limpaCamposPerfil(a){$("#perfil-img-captcha").attr("src","/pf/vendor/huge/tools/showCaptcha.php");a?$("#addUsuario").empty():"";a?$("#perfil_role_id").empty:"";$("#select_role_id").prop("disabled",true);$("#select_role_id option[value=0]").prop("selected",true);$("#user_id_user").val("");$("#user_id_empresa").val("");$("#user_id_fornecedor_perfil").val("");$("#user_role_title").val("");$("#user_short_name").val("");$("#user_role_id").val("");$("#perfil_btn_atualizar").prop("disabled",true);$("#perfil_btn_cancelar").prop("disabled",true);$("#span_user_name").html("");$("#perfil-txt-captcha").val("");$("#chk_is_validar_adm_gestor_perfil").prop("checked",false).prop("disabled",true)}function alteraSpanRoleTitle(b,c){var a=("000000"+b).slice(-6);$("#u"+a).html(c)}function alteraSpanIsValidar(c,a){var b=("000000"+c).slice(-6);$("#is_v_"+b).html(a?'<font style="color:#000;"><i class="fa fa-check-circle-o fa-lg"></i>&nbsp;</font>':'<font style="color:#d0d0d0;"><i class="fa fa-minus-circle fa-lg"></i>&nbsp;</font>')}function alteraClickExibirPerfil(a,c,g,d,k,l,b,h){var j=("000000"+c).slice(-6);$("#click_"+j).attr("onclick","exibePerfilAlteracao("+a+", "+c+", "+g+", "+d+", '"+k+"', '"+l+"', '"+b+"', '"+h+"')")};