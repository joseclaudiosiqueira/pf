
var previousId=0;$("#href_modal_fator_impacto").on("click",function(){comboRoteiro("item_roteiro","01",0,1)});$("#fatores_todos").on("click",function(){selecionaFatoresTodos($(this).prop("checked"))});$("#tipo_acao_todos").on("click",function(){selecionaTipoAcaoTodos($(this).prop("checked"))});$("#fechar_item_roteiro").on("click",function(){limpaCamposFatorImpacto(true);return true});$("#fti_btn_novo").on("click",function(){limpaCamposFatorImpacto(false);return true});$("#item_roteiro_id_roteiro").on("change",function(){limpaCamposFatorImpacto(false);atualizaTabelaFatorImpacto($(this).val(),0,0)});$("#item_roteiro_tipo").on("change",function(){if(!($(this).prop("checked"))){$("#item_roteiro_operador").bootstrapToggle("enable").bootstrapToggle("on")}else{$("#item_roteiro_operador").bootstrapToggle("on").bootstrapToggle("disable")}});$("#form_inserir_alterar_item").on("submit",function(){var g="";var l="";var c="";var e="";var h="";var a="";var j="";var i="";var k="";var b="";var d="";var f="";if($("#fatores_todos").prop("checked")){j="ALI;AIE;EE;SE;CE;OU;"}else{g=$("#item_roteiro_funcao1").prop("checked")?"ALI;":"";l=$("#item_roteiro_funcao2").prop("checked")?"AIE;":"";c=$("#item_roteiro_funcao3").prop("checked")?"EE;":"";e=$("#item_roteiro_funcao4").prop("checked")?"SE;":"";h=$("#item_roteiro_funcao5").prop("checked")?"CE;":"";a=$("#item_roteiro_funcao6").prop("checked")?"OU;":"";aplicaAlguns=g+""+l+""+c+""+e+""+h+""+a}if(j===""&&g===""&&l===""&&c===""&&e===""&&h===""&&a===""){$("#fatores_todos").prop("checked",true);$("#item_roteiro_funcao1").prop("checked",true);$("#item_roteiro_funcao2").prop("checked",true);$("#item_roteiro_funcao3").prop("checked",true);$("#item_roteiro_funcao4").prop("checked",true);$("#item_roteiro_funcao5").prop("checked",true);$("#item_roteiro_funcao6").prop("checked",true);j="ALI;AIE;EE;SE;CE;OU;"}if($("#tipo_acao_todos").prop("checked")){i="I;A;E;T;"}else{k=$("#tipo_acao_1").prop("checked")?"I;":"";d=$("#tipo_acao_2").prop("checked")?"A;":"";b=$("#tipo_acao_3").prop("checked")?"E;":"";f=$("#tipo_acao_4").prop("checked")?"T;":"";aplicaAcaoAlguns=k+""+d+""+b+""+f}if(i===""&&k===""&&d===""&&b===""&&f===""){$("#tipo_acao_todos").prop("checked",true);$("#tipo_acao_1").prop("checked",true);$("#tipo_acao_2").prop("checked",true);$("#tipo_acao_3").prop("checked",true);$("#tipo_acao_4").prop("checked",true);i="I;A;E;T;"}if($("#item_roteiro_id_roteiro").val()<1){swal({title:"Alerta",text:"Por favor selecione um roteiro para adicionar este item",type:"error",html:true,confirmButtonText:"Vou verificar, obrigado!"})}else{$.post("/pf/DIM.Gateway.php",{id:$("#fti_id").val(),acao:$("#fti_acao").val(),is_ativo:$("#item_roteiro_is_ativo").prop("checked")?1:0,descricao:$("#item_roteiro_descricao").val(),fator:$("#item_roteiro_fator").val(),fonte:$("#item_roteiro_fonte").val(),id_roteiro:$("#item_roteiro_id_roteiro").val(),operacao:$("#tipo_acao_todos").prop("checked")?i:aplicaAcaoAlguns,operador:$("#item_roteiro_operador").prop("checked")?0:1,sigla:$("#item_roteiro_sigla").val(),tipo:$("#item_roteiro_tipo").prop("checked")?"A":"F",aplica:$("#fatores_todos").prop("checked")?j:aplicaAlguns,arq:46,tch:0,sub:0,dlg:1},function(m){if(m.id>0){swal({title:"Informa&ccedil;&atilde;o",text:m.msg,type:"success",html:true,confirmButtonText:"Obrigado!"});if($("#fti_acao").val()==="inserir"){addLinhaFatorImpacto(m.id,$("#item_roteiro_is_ativo").prop("checked")?"on":"off",$("#item_roteiro_descricao").val(),$("#item_roteiro_fator").val(),$("#item_roteiro_fonte").val(),$("#tipo_acao_todos").prop("checked")?i:aplicaAcaoAlguns,$("#item_roteiro_sigla").val(),$("#item_roteiro_tipo").prop("checked")?"A":"F",$("#fatores_todos").prop("checked")?j:aplicaAlguns,idEmpresa,$("#item_roteiro_operador").prop("checked")?" (M)":" (D)");previousId=m.id;$("#tr_"+previousId).animate({opacity:".5"},1000);$("#fti_acao").val("alterar");$("#fti_id").val(m.id);$("#fti_btn_inserir").prop("disabled",true);$("#fti_btn_novo").prop("disabled",false);$("#fti_btn_atualizar").prop("disabled",false)}else{if($("#fti_acao").val()==="alterar"){$("#tr_"+m.id).animate({opacity:"1.0"},1000);$("#sigla_"+m.id).html($("#item_roteiro_sigla").val());$("#descricao_"+m.id).html($("#item_roteiro_descricao").val());$("#fonte_"+m.id).html($("#item_roteiro_fonte").val());$("#operacao_"+m.id).html($("#tipo_acao_todos").prop("checked")?i.replace(/;/g,"-").substring(0,(i.length-1)):aplicaAcaoAlguns.replace(/;/g,"-").substring(0,(aplicaAcaoAlguns.length-1)));$("#aplica_"+m.id).html($("#fatores_todos").prop("checked")?j.replace(/;/g,"-").substring(0,(j.length-1)):aplicaAlguns.replace(/;/g,"-").substring(0,(aplicaAlguns.length-1)));$("#tipo_"+m.id).html($("#item_roteiro_tipo").prop("checked")?"A":"F"+($("#item_roteiro_operador").prop("checked")?" (M)":" (D)"));limpaCamposFatorImpacto(false)}}}},"json")}return false});function addLinhaFatorImpacto(w,v,u,q,o,l,i,g,d,z,y){var e=$("#addFatorImpacto").get(0);var j=e.insertRow(-1);var A=(z==0&&idEmpresa!=1)?false:true;j.id="tr_"+w;var s=j.insertCell(0);var p=j.insertCell(1);var n=j.insertCell(2);var k=j.insertCell(3);var h=j.insertCell(4);var f=j.insertCell(5);var c=j.insertCell(6);var b=v==="on"?"checked":"";var m=A?"":"disabled";s.innerHTML=A?'<a href="#" onclick="limpaCamposFatorImpacto(false); exibeFatorImpactoAlteracao('+w+');"><span id="sigla_'+w+'">'+i+'</span></a> - <span id="descricao_'+w+'">'+u+"</span>":i+" - "+u;p.innerHTML='<span id="fonte_'+w+'">'+o+"</span>";n.innerHTML=q;k.innerHTML='<input onchange="alteraStatusFatorImpacto($(this).val(), $(this).prop(\'checked\'));" value="'+w+'" type="checkbox" data-toggle="toggle" data-onstyle="success" data-style="slow" data-on="Ativo" data-off="Inativo" class="datatoggle" '+b+" "+m+">";h.innerHTML='<span id="operacao_'+w+'">'+l.replace(/;/g,"-").substring(0,(l.length-1))+"<span>";f.innerHTML='<span id="aplica_'+w+'">'+d.replace(/;/g,"-").substring(0,(d.length-1))+"</span>";c.innerHTML='<span id="tipo_'+w+'">'+g+(y==0?" (M)":" (D)")+"</span>";$(".datatoggle").bootstrapToggle()}function exibeFatorImpactoAlteracao(a){$.post("/pf/DIM.Gateway.php",{i:a,ti:0,tc:1,arq:68,tch:1,sub:0,dlg:1},function(b){$("#item_roteiro_sigla").val(b[0].sigla);$("#item_roteiro_fator").val(b[0].fator).prop("disabled",true);$("#item_roteiro_descricao").val(b[0].descricao);$("#item_roteiro_fonte").val(b[0].fonte);arrFatoresTodos=b[0].aplica.split(";");if(arrFatoresTodos.length==7){$("#fatores_todos").prop("checked",true);selecionaFatoresTodos(true)}else{$("#fatores_todos").prop("checked",false);for(x=0;x<arrFatoresTodos.length;x++){switch(arrFatoresTodos[x]){case"ALI":$("#item_roteiro_funcao1").prop("checked",true);break;case"AIE":$("#item_roteiro_funcao2").prop("checked",true);break;case"EE":$("#item_roteiro_funcao3").prop("checked",true);break;case"SE":$("#item_roteiro_funcao4").prop("checked",true);break;case"CE":$("#item_roteiro_funcao5").prop("checked",true);break;case"OU":$("#item_roteiro_funcao6").prop("checked",true);break}}}arrAplicaAcaoTodos=b[0].operacao.split(";");if(arrAplicaAcaoTodos.length==5){$("#tipo_acao_todos").prop("checked",true);selecionaTipoAcaoTodos(true)}else{$("#tipo_acao_todos").prop("checked",false);for(x=0;x<arrAplicaAcaoTodos.length;x++){switch(arrAplicaAcaoTodos[x]){case"I":$("#tipo_acao_1").prop("checked",true);break;case"A":$("#tipo_acao_2").prop("checked",true);break;case"E":$("#tipo_acao_3").prop("checked",true);break;case"T":$("#tipo_acao_4").prop("checked",true);break}}}$("#item_roteiro_tipo").bootstrapToggle(b[0].tipo==="A"?"on":"off");$("#item_roteiro_operador").bootstrapToggle(b[0].operador==0?"on":"off");$("#item_roteiro_is_ativo").bootstrapToggle(b[0].isAtivo).bootstrapToggle("disable");$("#fti_id").val(a);$("#fti_acao").val("alterar");$("#fti_btn_novo").prop("disabled",false);$("#fti_btn_inserir").prop("disabled",true);$("#fti_btn_atualizar").prop("disabled",false);if(previousId==0){$("#tr_"+a).animate({opacity:".5"},1000);previousId=a}else{$("#tr_"+previousId).animate({opacity:"1.0"},1000);$("#tr_"+a).animate({opacity:".5"},1000);previousId=a}},"json")}function alteraStatusFatorImpacto(b,a){iWait("w_fator_impacto_status",true);if($("#fti_id").val()!==""&&$("#fti_id").val()===b){$("#item_roteiro_is_ativo").bootstrapToggle("enable").bootstrapToggle(a?"on":"off").bootstrapToggle("disable")}$.post("/pf/DIM.Gateway.php",{i:b,p:a?1:0,arq:35,tch:0,sub:0,dlg:1},function(c){iWait("w_fator_impacto_status",false)},"json")}function limpaCamposFatorImpacto(a){$("#fti_acao").val("inserir");$("#fti_id").val("");$("#item_roteiro_sigla").val("");$("#item_roteiro_fator").val("").prop("disabled",false);$("#item_roteiro_descricao").val("");$("#item_roteiro_fonte").val("");$("#fatores_todos").prop("checked",false);$("#item_roteiro_funcao1").prop("checked",false);$("#item_roteiro_funcao2").prop("checked",false);$("#item_roteiro_funcao3").prop("checked",false);$("#item_roteiro_funcao4").prop("checked",false);$("#item_roteiro_funcao5").prop("checked",false);$("#item_roteiro_funcao6").prop("checked",false);$("#tipo_acao_todos").prop("checked",false);$("#tipo_acao_1").prop("checked",false);$("#tipo_acao_2").prop("checked",false);$("#tipo_acao_3").prop("checked",false);$("#tipo_acao_4").prop("checked",false);$("#item_roteiro_tipo").bootstrapToggle("on");$("#item_roteiro_operador").bootstrapToggle("on").bootstrapToggle("disable");$("#item_roteiro_is_ativo").bootstrapToggle("on").bootstrapToggle("enable");$("#fti_btn_novo").prop("disabled",true);$("#fti_btn_inserir").prop("disabled",false);$("#fti_btn_atualizar").prop("disabled",true);if(a){$("#addFatorImpacto").empty()}if(previousId>0){$("#tr_"+previousId).animate({opacity:"1.0"},1000);previousId=0}arrAplicaAcaoTodos=[];arrFatoresTodos=[]}function selecionaFatoresTodos(a){for(x=1;x<=6;x++){$("#item_roteiro_funcao"+x).prop("checked",a)}}function selecionaTipoAcaoTodos(a){for(x=1;x<=4;x++){$("#tipo_acao_"+x).prop("checked",a)}}function atualizaTabelaFatorImpacto(a){if(a>0){iWait("w_item_roteiro_id_roteiro",true);$.post("/pf/DIM.Gateway.php",{i:a,tc:0,t:"01",arq:68,tch:1,sub:0,dlg:1},function(b){$("#addFatorImpacto").empty();for(x=0;x<b.length;x++){addLinhaFatorImpacto(b[x].id,b[x].isAtivo,b[x].descricao,b[x].fator,b[x].fonte,b[x].operacao,b[x].sigla,b[x].tipo,b[x].aplica,b[x].idEmpresa,b[x].operador)}$("#fti_btn_inserir").prop("disabled",(Number(a)==1||Number(a)==2||Number(a)==3)?true:false);iWait("w_item_roteiro_id_roteiro",false)},"json")}else{$("#addFatorImpacto").empty()}}function verificaFatoresTodos(a){if(!a){$("#fatores_todos").prop("checked",false)}else{if($("#item_roteiro_funcao1").prop("checked")&&$("#item_roteiro_funcao2").prop("checked")&&$("#item_roteiro_funcao3").prop("checked")&&$("#item_roteiro_funcao4").prop("checked")&&$("#item_roteiro_funcao5").prop("checked")&&$("#item_roteiro_funcao6").prop("checked")){$("#fatores_todos").prop("checked",true)}}}function verificaAcaoTodos(a){if(!a){$("#tipo_acao_todos").prop("checked",false)}else{if($("#tipo_acao_1").prop("checked")&&$("#tipo_acao_2").prop("checked")&&$("#tipo_acao_3").prop("checked")&&$("#tipo_acao_4").prop("checked")){$("#tipo_acao_todos").prop("checked",true)}}};