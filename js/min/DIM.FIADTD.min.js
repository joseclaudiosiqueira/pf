
$("#form-modal-inserir-alterar-listas").on("hidden.bs.modal",function(){limpaCamposLista($("#descricao-funcao-td").val())});$("#form-linha-lista").on("submit",function(){return false});$("#btn-adicionar-linha-lista").on("click",function(){adicionaLinhaForm();return false});$("#descricao-linha-lista").on("change",function(){adicionaLinhaForm();return false});function adicionaLinhaForm(){var e=$("#id-linha-descricao").val();var d=$("#id-descricao-td").val();var b=$("#operacao-linha-lista").val();var c=$("#descricao-funcao-td").val();var a=$("#descricao-linha-lista").val();var f=$("#"+c+"_tabela").val();var g=f.toLowerCase();if(b==="alterar-em-memoria"){$("#descricao-linha-lista-"+$("#id-span-linha-lista").val()).html(a);arrLinhasAtuaisTD[arrLinhasAtuaisTD.indexOf($("#descricao-anterior").val())]=a}else{if(b==="alterar-em-ajax"){$("#descricao-linha-lista-"+$("#id-span-linha-lista").val()).html(a);$.post("/pf/DIM.Gateway.php",{id:d,d:a,a:"alterar",t:g,arq:21,tch:0,sub:-1,dlg:1},function(i){},"json")}else{if(b==="inserir"){if(e>0){$.post("/pf/DIM.Gateway.php",{ip:e,d:a,a:b,t:g,arq:21,tch:0,sub:-1,dlg:1},function(i){var k=("000000"+i.id).slice(-6);addLinhaLista(k,a,c,false);var j=Number($("#"+c+"-badge-td").html());$("#"+c+"-badge-td").html(j+1);if($("#"+c+"_metodo").val()==3){$("#"+c+"_td").val(j+1)}},"json")}else{var h=("000000"+Math.floor((Math.random()*100000)+1)).slice(-6);addLinhaLista(h,a,c,true)}}}}$("#descricao-linha-lista").val("").get(0).focus();$("#btn-adicionar-linha-lista").html('<i class="fa fa-plus-circle"></i>&nbsp;Adicionar');$("#operacao-linha-lista").val("inserir");$("#id-span-linha-lista").val("");$("#descricao-anterior").val("");return false}$("#fechar-listas").on("click",function(){limpaCamposLista($("#descricao-funcao-td").val())});$("#desc-td-dados").on("click",function(){var c=$("#id-linha-descricao").val();var a=$("#descricao-funcao-td").val();var b=$("#"+a+"_tabela").val();if(c==0){if(arrLinhasAtuaisTD.length>0){tVal=arrLinhasAtuaisTD.length;for(x=0;x<tVal;x++){var c=("000000"+Math.floor((Math.random()*100000)+1)).slice(-6);addLinhaLista(c,arrLinhasAtuaisTD[x],"dados",false)}}}else{$.post("/pf/DIM.Gateway.php",{i:c,t:0,f:b.toLowerCase(),arq:33,tch:1,sub:-1,dlg:1},function(d){if(d.length>0){if(d[0].id==0){swal({title:"Alerta",text:"Houve um erro na procura pelo #ID, favor refa&ccedil;a a opera&ccedil;&atilde;o",type:"error",html:true,confirmButtonText:"Vou verificar, obrigado!"})}else{for(x=0;x<d.length;x++){var e=("000000"+d[x].id).slice(-6);addLinhaLista(e,d[x].descricao,"dados",true)}}}},"json")}$("#descricao-funcao-td").val("dados")});$("#desc-td-transacao").on("click",function(){var c=$("#id-linha-descricao").val();var a=$("#descricao-funcao-td").val();var b=$("#"+a+"_tabela").val();if(c==0){if(arrLinhasAtuaisTD.length>0){tVal=arrLinhasAtuaisTD.length;for(x=0;x<tVal;x++){var c=("000000"+Math.floor((Math.random()*100000)+1)).slice(-6);addLinhaLista(c,arrLinhasAtuaisTD[x],"transacao",false)}}}else{$.post("/pf/DIM.Gateway.php",{i:c,t:0,f:b.toLowerCase(),arq:33,tch:1,sub:-1,dlg:1},function(d){if(d.length>0){for(x=0;x<d.length;x++){var e=("000000"+d[x].id).slice(-6);addLinhaLista(e,d[x].descricao,"transacao",true)}}},"json")}$("#descricao-funcao-td").val("transacao")});function addLinhaLista(g,d,l,m){var o=$("#addLinhaLista").get(0);var c=o.insertRow(-1);var k=$("#id-linha-descricao").val();var n="";c.className="fadeIn";var j=c.insertCell(0);var h=c.insertCell(1);var e=c.insertCell(2);if(k==0){n="m";j.innerHTML="#"+g;h.innerHTML='<a href="#" onclick="exibeLinhaAlteracaoDescricao(\''+g+"', 'm');\"><span id=\"descricao-linha-lista-"+g+'">'+d+"</span></a>";if(m){arrLinhasAtuaisTD.push(d);$("#"+l+"-badge-td").html(arrLinhasAtuaisTD.length);if($("#"+l+"_metodo")==3){$("#"+l+"_td").val(arrLinhasAtuaisTD.length)}}}else{n="a";j.innerHTML='<a href="#" onclick="exibeLinhaAlteracaoDescricao(\''+g+"', 'a');\">#"+g+"</a>";h.innerHTML='<span id="descricao-linha-lista-'+g+'">'+d+"</span>"}var a=document.createElement("button");a.type="button";a.className="btn btn-default btn-block btn-xs";a.innerHTML='<i class="fa fa-trash"></i>';a.setAttribute("onclick","excluirLinhaLista('"+g+"', parentNode.parentNode.rowIndex, '"+d+"', '"+n+"', '"+l+"');");a.id="excluir_"+g;a.disabled=isAutorizadoAlterar?false:true;e.appendChild(a)}function excluirLinhaLista(b,h,g,e,c){var a=document.getElementById("addLinhaLista");a.deleteRow(h-1);e==="m"?arrLinhasAtuaisTD.splice(arrLinhasAtuaisTD.indexOf(g),1):$.post("/pf/DIM.Gateway.php",{id:parseInt(b),a:"excluir",arq:21,tch:0,sub:-1,dlg:1},function(d){},"json");if(e==="m"){$("#"+c+"-badge-td").html(arrLinhasAtuaisTD.length);arrLinhasAtuaisTD.length==0?$("#"+c+"_td").val(1):$("#"+c+"_td").val(arrLinhasAtuaisTD.length)}else{$("#"+c+"-badge-td").html(parseInt($("#"+c+"-badge-td").html())-1);Number($("#"+c+"-badge-td").html())==0?$("#"+c+"_td").val(1):$("#"+c+"_td").val(parseInt($("#"+c+"-badge-td").html()))}$("#descricao-linha-lista").val("").get(0).focus();return true}function exibeLinhaAlteracaoDescricao(b,a){$("#descricao-linha-lista").val($("#descricao-linha-lista-"+b).html()).get(0).focus();$("#id-span-linha-lista").val(b);$("#id-descricao-td").val(parseInt(b));$("#btn-adicionar-linha-lista").html('<i class="fa fa-refresh"></i>&nbsp;Atualizar');a==="m"?$("#operacao-linha-lista").val("alterar-em-memoria"):$("#operacao-linha-lista").val("alterar-em-ajax");$("#descricao-anterior").val($("#descricao-linha-lista-"+b).html())}function limpaCamposLista(a){$("#addLinhaLista").empty();$("#descricao-linha-lista").val("");$("#tipo-linha-lista").val("");if(Number($("#id-linha-descricao").val())==0){$("#id-linha-descricao").val("0")}$("#id-descricao-td").val("");return true};