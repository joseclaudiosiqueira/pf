
function consultaFuncaoDadosBaseline(c,a){$.post("/pf/DIM.Gateway.php",{i:c,b:a,arq:42,tch:1,sub:-1,dlg:1},function(b){var e=Number(b[0].pfa);var d=Number(b[0].pfb);$("#dados_id").val(acForms==="al"?b[0].id:0);$("#dados_td").val(b[0].td);$("#dados_tr").val(b[0].tr);$("#dados_complexidade").val(b[0].complexidade);$("#dados_fonte").val(b[0].fonte);$("#dados_metodo").val(b[0].id_metodo);verificaMetodo("dados",$("#dados_metodo"),$("#dados_id_roteiro"),$("#dados_operacao"));$("#dados_pfb").val(d.toFixed(4));$("#dados_impacto").val(0);$("#dados_observacoes").val(b[0].obs_funcao);$("#dados_observacoes_validacao").val(b[0].obs_validar);arrTR=b[0].descricaoTR;jQuery("#dados_descricao_tr").tagsManager("empty");for(x=0;x<arrTR.length;x++){jQuery("#dados_descricao_tr").tagsManager("pushTag",arrTR[x])}arrTD=b[0].descricaoTD;jQuery("#dados_descricao_td").tagsManager("empty");for(x=0;x<arrTD.length;x++){jQuery("#dados_descricao_td").tagsManager("pushTag",arrTD[x])}detalheItem(b[0].selImpacto,"dados");if($("#dados_operacao").val()==="A"||$("#dados_operacao").val()==="E"){$("#dados-is-mudanca").bootstrapToggle("enable").bootstrapToggle("off")}$(".tm-tag-remove").css({visibility:(!isAutorizadoAlterar?"hidden":"visible")});$("#dados_fe").val(b[0].fe)},"json")}function retornaFuncaoDados(c,a,d,e,f){acForms="al";fAtual=a;$.post("/pf/DIM.Gateway.php",{i:c,b:a,arq:42,tch:1,sub:-1,dlg:1},function(b){if(b[0].operacao==="N"){swal({title:"Informa&ccedil;&atilde;o",text:"Esta funcionalidade foi inserida de forma INDICATIVA, n&atilde;o &eacute; poss&iacute;vel alterar.",type:"info",html:true,confirmButtonText:"Entendi!"})}else{$("#form_modal_funcao_dados").modal("toggle");if(a==="ALI"){$("#cabecalho_funcao").val(title_ali_alt);$("#dados_h4-modal").html(title_ali_alt);$("#dados_tabela").val("ALI");$("#is-crud-atualizar-dependentes").bootstrapToggle(b[0].isCrud==1?"on":"off").bootstrapToggle(b[0].isCrud==1?"enable":"disable");$("#dados_fe").val(b[0].fe).prop("disabled",false)}else{$("#cabecalho_funcao").val(title_aie_alt);$("#dados_h4-modal").html(title_aie_alt);$("#dados_tabela").val("AIE");$("#is-crud-atualizar-dependentes").bootstrapToggle("off").bootstrapToggle("disable");$("#dados_fe").val(0).prop("disabled",true)}$("#dados_qtd_atual").val(d);$("#dados_id").val(c);$("#dados_id_roteiro").val(b[0].id_roteiro);idRoteiro=b[0].id_roteiro;idRoteiro==3?$("#dados_id_roteiro").prop("disabled",false):$("#dados_id_roteiro").prop("disabled",true);$("#dados_operacao").val(b[0].operacao);$("#dados_metodo").val(b[0].id_metodo);$("#dados_entrega").val(b[0].entrega).mask("00").TouchSpin({min:1,max:$("#entregas").val(),step:1,boostat:5,maxboostedstep:10,postfix:""}).prop("readonly",true);verificaOperacao("dados",b[0].operacao,b[0].id_roteiro,b[0].selImpacto,a,acForms);verificaMetodo("dados",$("#dados_metodo"),$("#dados_id_roteiro"),$("#dados_operacao"));if(b[0].operacao==="T"){$("#dados_op1").prop("disabled",true);$("#dados_op2").prop("disabled",true);$("#dados_op3").prop("disabled",true);$("#dados_me1").prop("disabled",true);$("#dados_me2").prop("disabled",true)}if(abAtual==3){$("#dados_me1").prop("disabled",true);$("#dados_me2").prop("disabled",true)}situacaoLinha=b[0].situacao;$("#dados_fd").val(b[0].fd);if(b[0].operacao!=="I"&&b[0].operacao!=="T"&&b[0].tipoImpacto==="A"){$("#dados_fd").prop("disabled",false)}$("#dados_funcao").val(b[0].funcao).prop("readonly",true);$("#dados_funcao_nome_anterior").val(b[0].funcao);$("#dados_td").val(b[0].td);$("#dados_tr").val(b[0].tr);$("#dados_complexidade").val(b[0].complexidade);$("#dados_fonte").val(b[0].fonte);if(b[0].isMudanca==1){$("#dados-is-mudanca").bootstrapToggle("enable").bootstrapToggle("on");$("#dados-fase").val(b[0].faseMudanca);$("#dados-percentual-fase").val(b[0].percentualFase==0?"":b[0].percentualFase).prop("readonly",false)}else{if(b[0].operacao!=="I"&&b[0].operacao!=="T"){$("#dados-is-mudanca").bootstrapToggle("enable");$("#dados-fase").val(0);$("#dados-percentual-fase").val("").prop("readonly",true)}else{$("#dados-is-mudanca").bootstrapToggle("off").bootstrapToggle("disable");$("#dados-fase").val(0);$("#dados-percentual-fase").val("").prop("readonly",true)}}var g=Number(b[0].pfb);$("#dados_pfb").val(g.toFixed(4));var h=Number(b[0].pfa);$("#dados_pfa").val(h.toFixed(4));$("#dados_observacoes").val(b[0].obs_funcao);$("#dados_observacoes_validacao").val(b[0].obs_validar);arrTR=b[0].descricaoTR;for(x=0;x<arrTR.length;x++){jQuery("#dados_descricao_tr").tagsManager("pushTag",arrTR[x])}arrTD=b[0].descricaoTD;for(x=0;x<arrTD.length;x++){jQuery("#dados_descricao_td").tagsManager("pushTag",arrTD[x])}$("#dados_btn_if").prop("disabled",true);$("#dados_btn_in").prop("disabled",true);$("#dados_btn_al").prop("disabled",!isAutorizadoAlterar);$("#id-linha-descricao").val(c);$("#dados-badge-td").html(b[0].quantidadeTD);(Number(b[0].quantidadeTD)>0&&$("#dados_metodo").val()==3)?$("#dados_td").val(b[0].quantidadeTD):null;$("#descricao-funcao-td").val("dados");$("#btn-listar-itens-dados").prop("disabled",!1);detalheItem(b[0].selImpacto,"dados");$("#dados_id_funcao_baseline").val(b[0].idBaseline);if(Number(b[0].idBaseline)>0&&b[0].operacao==="I"&&Number(b[0].situacao)==2&&!(ac==="vw"||ac==="vi"||ac==="ve"||ac==="ai"||ac==="ae"||ac==="re")){swal({title:"Alerta",text:"A fun&ccedil;&atilde;o foi inserida nesta contagem, entretanto j&aacute; foi validada na Baseline. Desta forma n&atilde;o &eacute; poss&iacute;vel realizar as altera&ccedil;&otilde;es aqui. Caso seja uma altera&ccedil;&atilde;o solicitada por um outro projeto ou por este mesmo, inclua um novo item como A - Altera&ccedil;&atilde;o ou E - Exclus&atilde;o.",type:"error",html:true,confirmButtonText:"Entendi!"},function(){autorizaAlteracaoCamposLinha(false,"dados")})}else{if((abAtual==3||abAtual==4)&&acForms==="al"&&b[0].idGerador>0){swal({title:"Alerta",text:"Esta fun&ccedil;&atilde;o foi inserida pela contagem<br />#ID: <strong>"+("000000"+b[0].idContagem).slice(-6)+"</strong>. Desta forma n&atilde;o &eacute; poss&iacute;vel realizar as altera&ccedil;&otilde;es aqui.",type:"error",html:true,confirmButtonText:"Entendi!"},function(){autorizaAlteracaoCamposLinha(false,"dados")})}else{$("#dados_btn_if").prop("disabled",true);$("#dados_btn_in").prop("disabled",true);$("#dados_btn_al").prop("disabled",isAutorizadoAlterar?false:true);if(isAutorizadoAlterar){$("#dados_funcao").prop("readonly",true).css({"background-color":"#ffffe5"});$("#alterar-funcao-dados").prop("disabled",false)}}}$(".tm-tag-remove").css({visibility:(!isAutorizadoAlterar?"hidden":"visible")});if(ac==="vw"||ac==="vi"||ac==="ve"||ac==="ai"||ac==="ae"){autorizaAlteracaoCamposLinha(false,"dados")}$("#is-crud").bootstrapToggle(b[0].isCrud==1?"on":"off").bootstrapToggle("disable")}},"json")}function insereFuncaoDados(j){var l=jQuery("#dados_descricao_tr").tagsManager("tags");var c=jQuery("#dados_descricao_td").tagsManager("tags");var f=validaFormFuncao("dados");if(!f.sucesso){swal({title:"Alerta",text:f.msg,type:"error",html:true,confirmButtonText:"Entendi!"},function(){return false});return false}else{var e=$("#is-crud").prop("checked");var n=0;var i=$("#dados-is-mudanca").prop("checked")?1:0;var k=$("#dados-fase").val();var m=$("#dados-percentual-fase").val();var d=$("#dados_operacao").val();var h=$("#dados_fd").val();var a=$("#dados_tabela").val();var g=$("#dados_fe").val();$.post("/pf/DIM.Gateway.php",{dados_operacao:$("#dados_operacao").val(),dados_tabela:a,dados_metodo:$("#dados_metodo").val(),dados_entrega:$("#dados_entrega").val(),dados_id:idContagem,dados_qtd_atual:$("#dados_qtd_atual").val(),dados_id_roteiro:$("#dados_id_roteiro").val(),dados_funcao:$("#dados_funcao").is("select")&&(abAtual==2&&(d==="A"||d==="E")||(a.toLowerCase()==="aie"&&d==="I"))?$("#dados_funcao").find("option:selected").text().split(" > ")[5]:$("#dados_funcao").val(),dados_td:$("#dados_td").val(),dados_tr:$("#dados_tr").val(),dados_complexidade:$("#dados_complexidade").val(),dados_pfb:$("#dados_pfb").val(),dados_impacto:$("#dados_impacto").val(),dados_pfa:$("#dados_pfa").val(),dados_observacoes:$("#dados_observacoes").val(),dados_observacoes_validacao:$("#dados_observacoes_validacao").val(),dados_fonte:$("#dados_fonte").val(),dados_descricao_tr:l,dados_descricao_td:c,is_mudanca:i,fase_mudanca:k,percentual_fase:m,funcao_id_baseline:(abAtual==2&&(d==="A"||d==="E"))?$("#dados_funcao").children(":selected").val():0,dados_fd:h,dados_fe:g,abrangencia_atual:abAtual,contagem_id_baseline:abAtual==2?$("#contagem_id_baseline").children(":selected").val():0,is_crud:e?1:0,is_crud_atualizar_dependentes:n?1:0,arq:26,tch:0,sub:-1,dlg:1},function(o){if(Number(o[0].id)>0){var b=document.getElementById("add"+o[0].tabela);var q=b.insertRow(-1);var p=Number(o[0].pfb);var r=Number(o[0].pfa);insereLinha(o[0].id,o[0].tabela,q,o[0].operacao,o[0].funcao,o[0].td,o[0].tr,o[0].complexidade,p.toFixed(4),o[0].siglaFator,r.toFixed(4),o[0].obsFuncao,o[0].situacao,o[0].entrega,0,0,false,i,k,m,h,e?1:0,n?1:0,g)}else{swal({title:"Alerta",text:_ERR_INSERCAO,type:"error",html:true,confirmButtonText:"Entendi!"})}limpaCampos("dados");if(a==="ALI"&&d==="I"&&e){zeraTabelaEstatisticas();isSalvarEstatisticas=false;listaFuncao(idContagem,"ee",$("#addEE").get(0),"transacao","id","ASC",true);listaFuncao(idContagem,"ce",$("#addCE").get(0),"transacao","id","ASC",true);isSalvarEstatisticas=true}},"json");return true}}function insereFuncaoDadosIndicativa(a,c){$.post("/pf/DIM.Gateway.php",{dados_operacao:"N",dados_tabela:a,dados_metodo:1,dados_entrega:1,dados_id:idContagem,dados_qtd_atual:1,dados_id_roteiro:3,dados_funcao:c,dados_td:19,dados_tr:1,dados_complexidade:"Media",dados_pfb:a==="ALI"?35:15,dados_impacto:"41;1;FI [100%] - PF.INSERCAO.AUTOMATICA;A",dados_pfa:a==="ALI"?35:15,dados_observacoes:"Inserção automática para contagem Indicativa",dados_observacoes_validacao:"Inserção automática para contagem Indicativa",dados_fonte:"Método NESMA - Indicativa",dados_descricao_tr:[],dados_descricao_td:[],is_mudanca:0,fase_mudanca:0,percentual_fase:0,funcao_id_baseline:0,dados_fd:0,dados_fe:0,abrangencia_atual:abAtual,contagem_id_baseline:0,arq:26,tch:0,sub:-1,dlg:1},function(d){if(Number(d[0].id)>0){var b=document.getElementById("add"+d[0].tabela);var f=b.insertRow(-1);var e=Number(d[0].pfb);var g=Number(d[0].pfa);insereLinha(d[0].id,d[0].tabela,f,d[0].operacao,d[0].funcao,d[0].td,d[0].tr,d[0].complexidade,e.toFixed(4),d[0].siglaFator,g.toFixed(4),d[0].obsFuncao,d[0].situacao,d[0].entrega,0,0,false,0,"",0,0,0)}else{swal({title:"Alerta",text:_ERR_INSERCAO,type:"error",html:true,confirmButtonText:"Entendi!"})}},"json");return""}function alteraFuncaoDados(i){var k=jQuery("#dados_descricao_tr").tagsManager("tags");var a=jQuery("#dados_descricao_td").tagsManager("tags");var d=validaFormFuncao("dados");if(!d.sucesso){swal({title:"Alerta",text:d.msg,type:"error",html:true,confirmButtonText:"Entendi!"})}else{var m=$("#is-crud-atualizar-dependentes").prop("checked")?1:0;var h=$("#dados-is-mudanca").prop("checked")?1:0;var j=$("#dados-fase").val();var l=$("#dados-percentual-fase").val();var g=$("#dados_fd").val();var c=$("#is-crud").prop("checked")?1:0;var e=$("#dados_fe").val();var f=situacaoLinha==3?3:(situacaoLinha==4?3:(abAtual==3||abAtual==4?2:1));$.post("/pf/DIM.Gateway.php",{dados_operacao:$("#dados_operacao").val(),dados_tabela:$("#dados_tabela").val(),dados_metodo:$("#dados_metodo").val(),dados_entrega:$("#dados_entrega").val(),dados_id:$("#dados_id").val(),dados_qtd_atual:$("#dados_qtd_atual").val(),dados_id_roteiro:$("#dados_id_roteiro").val(),dados_funcao:$("#dados_funcao").val(),dados_td:$("#dados_td").val(),dados_tr:$("#dados_tr").val(),dados_complexidade:$("#dados_complexidade").val(),dados_pfb:$("#dados_pfb").val(),dados_impacto:$("#dados_impacto").val(),dados_pfa:$("#dados_pfa").val(),dados_observacoes:$("#dados_observacoes").val(),dados_observacoes_validacao:$("#dados_observacoes_validacao").val(),dados_fonte:$("#dados_fonte").val(),dados_descricao_tr:k,dados_descricao_td:a,is_mudanca:h,fase_mudanca:j,percentual_fase:l,contagem_id_baseline:$("#contagem_id_baseline option:selected").val(),situacao:f,dados_fd:g,dados_fe:e,funcao_id_baseline:$("#dados_id_funcao_baseline").val(),acao_forms:acForms,abrangencia_atual:abAtual,id_contagem:idContagem,is_crud:c,is_crud_atualizar_dependentes:m,dados_funcao_is_alterar_nome:$("#dados_funcao_is_alterar_nome").val(),dados_funcao_nome_anterior:$("#dados_funcao_nome_anterior").val(),arq:5,tch:0,sub:-1,dlg:1},function(q){if(Number(q.id)>0){var p=Number(q.pfan);var b=Number(q.pfbn);var r=$("#dados_qtd_atual").val();var z=q.tabela;var u=Number(q.pfa);var s=Number(q.pfb);var o=q.obsFuncao;var n=divOperacao(q.operacao);$("#oper_"+z+"_"+r).html(n);$("#funcao_"+z+"_"+r).html(q.funcao);$("#td_"+z+"_"+r).html(q.td);$("#tr_"+z+"_"+r).html(q.tr);$("#complexidade_"+z+"_"+r).html(q.complexidade);$("#pfb_"+z+"_"+r).html(s.toFixed(4));var v="";var A="";var w="";if(q.operacao==="A"||q.operacao==="E"){if(q.isMudanca==1){v="<br />Retrabalho: "+q.faseMudanca+" - "+q.percentualFase+"%"}}if(Number(g)>0){A=(q.isMudanca?"&nbsp;&nbsp;&nbsp;":"<br />")+"Fator Documentação: "+parseFloat(g).toFixed(2)}if(Number(e)>0){w="<br />Formulário Estendido: "+parseFloat(e).toFixed(2)}$("#siglaFator_"+z+"_"+r).html(q.siglaFator+(q.isMudanca?v:"")+A+w);$("#pfa_"+z+"_"+r).html(u.toFixed(4));$("#pfa_"+z+"_"+r).html(u.toFixed(4));$("#ent_"+z+"_"+r+"_"+q.id).html(q.entrega);$("#obs_"+z+"_"+r).html(o);setSituacao(f,"cell1_"+z+"_"+$("#dados_id").val());if(z==="ALI"&&Number(c)==1){zeraTabelaEstatisticas();isSalvarEstatisticas=false;listaFuncao(idContagem,"ee",$("#addEE").get(0),"transacao","id","ASC",true);listaFuncao(idContagem,"ce",$("#addCE").get(0),"transacao","id","ASC",true);isSalvarEstatisticas=true}recalculaEstatisticas(u,s,z,"alterar",p,b,true,e);swal("Dimension","O registro foi alterado com sucesso!","success");$("#form_modal_funcao_dados").modal("toggle");limpaCampos("dados")}else{swal({title:"Alerta",text:q.msg,type:"error",html:true,confirmButtonText:"Entendi!"},function(){$("#form_modal_funcao_dados").modal("toggle");limpaCampos("dados")})}},"json")}}$("#chk_pesq_baseline_tr").on("change",function(){atualizaItensTiposRegistros($(this),"PAB")});