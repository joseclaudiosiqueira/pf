
/*! selectize.js - v0.12.1 | https://github.com/brianreavis/selectize.js | Apache License (v2) */
!function(d,c){"function"==typeof define&&define.amd?define("sifter",c):"object"==typeof exports?module.exports=c():d.Sifter=c()}(this,function(){var j=function(d,c){this.items=d,this.settings=c||{diacritics:!0}};j.prototype.tokenize=function(e){if(e=o(String(e||"").toLowerCase()),!e||!e.length){return[]}var d,t,s,r,q=[],g=e.split(/ +/);for(d=0,t=g.length;t>d;d++){if(s=n(g[d]),this.settings.diacritics){for(r in l){l.hasOwnProperty(r)&&(s=s.replace(new RegExp(r,"g"),l[r]))}}q.push({string:g[d],regex:new RegExp(s,"i")})}return q},j.prototype.iterator=function(e,d){var f;f=m(e)?Array.prototype.forEach||function(h){for(var g=0,q=this.length;q>g;g++){h(this[g],g,this)}}:function(g){for(var c in this){this.hasOwnProperty(c)&&g(this[c],c,this)}},f.apply(e,[d])},j.prototype.getScoreFunction=function(r,q){var x,w,v,u;x=this,r=x.prepareSearch(r,q),v=r.tokens,w=r.options.fields,u=v.length;var t=function(f,e){var h,g;return f?(f=String(f||""),g=f.search(e.regex),-1===g?0:(h=e.string.length/f.length,0===g&&(h+=0.5),h)):0},s=function(){var b=w.length;return b?1===b?function(d,c){return t(c[w[0]],d)}:function(a,h){for(var g=0,d=0;b>g;g++){d+=t(h[w[g]],a)}return d/b}:function(){return 0}}();return u?1===u?function(b){return s(v[0],b)}:"and"===r.options.conjunction?function(f){for(var e,h=0,g=0;u>h;h++){if(e=s(v[h],f),0>=e){return 0}g+=e}return g/u}:function(e){for(var d=0,f=0;u>d;d++){f+=s(v[d],e)}return f/u}:function(){return 0}},j.prototype.getSortFunction=function(B,A){var z,y,x,w,v,u,t,s,r,q,b;if(x=this,B=x.prepareSearch(B,A),b=!B.query&&A.sort_empty||A.sort,r=function(d,c){return"$score"===d?c.score:x.items[c.id][d]},v=[],b){for(z=0,y=b.length;y>z;z++){(B.query||"$score"!==b[z].field)&&v.push(b[z])}}if(B.query){for(q=!0,z=0,y=v.length;y>z;z++){if("$score"===v[z].field){q=!1;break}}q&&v.unshift({field:"$score",direction:"desc"})}else{for(z=0,y=v.length;y>z;z++){if("$score"===v[z].field){v.splice(z,1);break}}}for(s=[],z=0,y=v.length;y>z;z++){s.push("desc"===v[z].direction?-1:1)}return u=v.length,u?1===u?(w=v[0].field,t=s[0],function(d,e){return t*i(r(w,d),r(w,e))}):function(g,E){var D,C,h;for(D=0;u>D;D++){if(h=v[D].field,C=s[D]*i(r(h,g),r(h,E))){return C}}return 0}:null},j.prototype.prepareSearch=function(f,c){if("object"==typeof f){return f}c=p({},c);var r=c.fields,q=c.sort,h=c.sort_empty;return r&&!m(r)&&(c.fields=[r]),q&&!m(q)&&(c.sort=[q]),h&&!m(h)&&(c.sort_empty=[h]),{options:c,query:String(f||"").toLowerCase(),tokens:this.tokenize(f),total:0,items:[]}},j.prototype.search=function(q,h){var v,u,t,s,r=this;return u=this.prepareSearch(q,h),h=u.options,q=u.query,s=h.score||r.getScoreFunction(u),q.length?r.iterator(r.items,function(b,c){v=s(b),(h.filter===!1||v>0)&&u.items.push({score:v,id:c})}):r.iterator(r.items,function(d,c){u.items.push({score:1,id:c})}),t=r.getSortFunction(u,h),t&&u.items.sort(t),u.total=u.items.length,"number"==typeof h.limit&&(u.items=u.items.slice(0,h.limit)),u};var i=function(d,c){return"number"==typeof d&&"number"==typeof c?d>c?1:c>d?-1:0:(d=k(String(d||"")),c=k(String(c||"")),d>c?1:c>d?-1:0)},p=function(g){var f,r,q,h;for(f=1,r=arguments.length;r>f;f++){if(h=arguments[f]){for(q in h){h.hasOwnProperty(q)&&(g[q]=h[q])}}}return g},o=function(b){return(b+"").replace(/^\s+|\s+$|/g,"")},n=function(b){return(b+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},m=Array.isArray||$&&$.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)},l={a:"[aÀÁÂÃÄÅàáâãäåĀāąĄ]",c:"[cÇçćĆčČ]",d:"[dđĐďĎ]",e:"[eÈÉÊËèéêëěĚĒēęĘ]",i:"[iÌÍÎÏìíîïĪī]",l:"[lłŁ]",n:"[nÑñňŇńŃ]",o:"[oÒÓÔÕÕÖØòóôõöøŌō]",r:"[rřŘ]",s:"[sŠšśŚ]",t:"[tťŤ]",u:"[uÙÚÛÜùúûüůŮŪū]",y:"[yŸÿýÝ]",z:"[zŽžżŻźŹ]"},k=function(){var q,g,v,u,t="",s={};for(v in l){if(l.hasOwnProperty(v)){for(u=l[v].substring(2,l[v].length-1),t+=u,q=0,g=u.length;g>q;q++){s[u.charAt(q)]=v}}}var r=new RegExp("["+t+"]","g");return function(b){return b.replace(r,function(c){return s[c]}).toLowerCase()}}();return j}),function(d,c){"function"==typeof define&&define.amd?define("microplugin",c):"object"==typeof exports?module.exports=c():d.MicroPlugin=c()}(this,function(){var d={};d.mixin=function(b){b.plugins={},b.prototype.initializePlugins=function(h){var m,l,k,j=this,i=[];if(j.plugins={names:[],settings:{},requested:{},loaded:{}},c.isArray(h)){for(m=0,l=h.length;l>m;m++){"string"==typeof h[m]?i.push(h[m]):(j.plugins.settings[h[m].name]=h[m].options,i.push(h[m].name))}}else{if(h){for(k in h){h.hasOwnProperty(k)&&(j.plugins.settings[k]=h[k],i.push(k))}}}for(;i.length;){j.require(i.shift())}},b.prototype.loadPlugin=function(a){var h=this,g=h.plugins,f=b.plugins[a];if(!b.plugins.hasOwnProperty(a)){throw new Error('Unable to find "'+a+'" plugin')}g.requested[a]=!0,g.loaded[a]=f.fn.apply(h,[h.plugins.settings[a]||{}]),g.names.push(a)},b.prototype.require=function(f){var e=this,g=e.plugins;if(!e.plugins.loaded.hasOwnProperty(f)){if(g.requested[f]){throw new Error('Plugin has circular dependency ("'+f+'")')}e.loadPlugin(f)}return g.loaded[f]},b.define=function(a,e){b.plugins[a]={name:a,fn:e}}};var c={isArray:Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)}};return d}),function(d,c){"function"==typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],c):"object"==typeof exports?module.exports=c(require("jquery"),require("sifter"),require("microplugin")):d.Selectize=c(d.jQuery,d.Sifter,d.MicroPlugin)}(this,function(ay,ax,aw){var av=function(f,e){if("string"!=typeof e||e.length){var h="string"==typeof e?new RegExp(e,"i"):e,g=function(d){var c=0;if(3===d.nodeType){var p=d.data.search(h);if(p>=0&&d.data.length>0){var o=d.data.match(h),n=document.createElement("span");n.className="highlight";var m=d.splitText(p),l=(m.splitText(o[0].length),m.cloneNode(!0));n.appendChild(l),m.parentNode.replaceChild(n,m),c=1}}else{if(1===d.nodeType&&d.childNodes&&!/(script|style)/i.test(d.tagName)){for(var k=0;k<d.childNodes.length;++k){k+=g(d.childNodes[k])}}}return c};return f.each(function(){g(this)})}},au=function(){};au.prototype={on:function(d,c){this._events=this._events||{},this._events[d]=this._events[d]||[],this._events[d].push(c)},off:function(e,d){var f=arguments.length;return 0===f?delete this._events:1===f?delete this._events[e]:(this._events=this._events||{},void (e in this._events!=!1&&this._events[e].splice(this._events[e].indexOf(d),1)))},trigger:function(d){if(this._events=this._events||{},d in this._events!=!1){for(var c=0;c<this._events[d].length;c++){this._events[d][c].apply(this,Array.prototype.slice.call(arguments,1))}}}},au.mixin=function(e){for(var d=["on","off","trigger"],f=0;f<d.length;f++){e.prototype[d[f]]=au.prototype[d[f]]}};var at=/Mac/.test(navigator.userAgent),ar=65,aq=13,ap=27,ao=37,an=38,am=80,al=39,ak=40,aj=78,ai=8,ah=46,ag=16,af=at?91:17,ae=at?18:17,ad=9,ac=1,ab=2,aa=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("form").validity,Z=function(b){return"undefined"!=typeof b},Y=function(b){return"undefined"==typeof b||null===b?null:"boolean"==typeof b?b?"1":"0":b+""},X=function(b){return(b+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},W=function(b){return(b+"").replace(/\$/g,"$$$$")},V={};V.before=function(f,e,h){var g=f[e];f[e]=function(){return h.apply(f,arguments),g.apply(f,arguments)}},V.after=function(f,e,h){var g=f[e];f[e]=function(){var a=g.apply(f,arguments);return h.apply(f,arguments),a}};var U=function(d){var c=!1;return function(){c||(c=!0,d.apply(this,arguments))}},T=function(e,d){var f;return function(){var b=this,a=arguments;window.clearTimeout(f),f=window.setTimeout(function(){e.apply(b,a)},d)}},S=function(h,g,l){var k,j=h.trigger,i={};h.trigger=function(){var a=arguments[0];return -1===g.indexOf(a)?j.apply(h,arguments):void (i[a]=arguments)},l.apply(h,[]),h.trigger=j;for(k in i){i.hasOwnProperty(k)&&j.apply(h,i[k])}},R=function(f,e,h,g){f.on(e,h,function(a){for(var d=a.target;d&&d.parentNode!==f[0];){d=d.parentNode}return a.currentTarget=d,g.apply(this,[a])})},Q=function(f){var e={};if("selectionStart" in f){e.start=f.selectionStart,e.length=f.selectionEnd-e.start}else{if(document.selection){f.focus();var h=document.selection.createRange(),g=document.selection.createRange().text.length;h.moveStart("character",-f.value.length),e.start=h.text.length-g,e.length=g}}return e},P=function(h,g,l){var k,j,i={};if(l){for(k=0,j=l.length;j>k;k++){i[l[k]]=h.css(l[k])}}else{i=h.css()}g.css(i)},O=function(a,h){if(!a){return 0}var g=ay("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(a).appendTo("body");P(h,g,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var f=g.width();return g.remove(),f},N=function(e){var d=null,f=function(t,s){var r,q,p,o,n,m,b,a;t=t||window.event||{},s=s||{},t.metaKey||t.altKey||(s.force||e.data("grow")!==!1)&&(r=e.val(),t.type&&"keydown"===t.type.toLowerCase()&&(q=t.keyCode,p=q>=97&&122>=q||q>=65&&90>=q||q>=48&&57>=q||32===q,q===ah||q===ai?(a=Q(e[0]),a.length?r=r.substring(0,a.start)+r.substring(a.start+a.length):q===ai&&a.start?r=r.substring(0,a.start-1)+r.substring(a.start+1):q===ah&&"undefined"!=typeof a.start&&(r=r.substring(0,a.start)+r.substring(a.start+1))):p&&(m=t.shiftKey,b=String.fromCharCode(t.keyCode),b=m?b.toUpperCase():b.toLowerCase(),r+=b)),o=e.attr("placeholder"),!r&&o&&(r=o),n=O(r,e)+4,n!==d&&(d=n,e.width(n),e.triggerHandler("resize")))};e.on("keydown keyup update blur",f),f()},M=function(p,o){var n,m,l,k,b=this;k=p[0],k.selectize=b;var a=window.getComputedStyle&&window.getComputedStyle(k,null);if(l=a?a.getPropertyValue("direction"):k.currentStyle&&k.currentStyle.direction,l=l||p.parents("[dir]:first").attr("dir")||"",ay.extend(b,{order:0,settings:o,$input:p,tabIndex:p.attr("tabindex")||"",tagType:"select"===k.tagName.toLowerCase()?ac:ab,rtl:/rtl/i.test(l),eventNS:".selectize"+ ++M.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:p.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===o.loadThrottle?b.onSearchChange:T(b.onSearchChange,o.loadThrottle)}),b.sifter=new ax(this.options,{diacritics:o.diacritics}),b.settings.options){for(n=0,m=b.settings.options.length;m>n;n++){b.registerOption(b.settings.options[n])}delete b.settings.options}if(b.settings.optgroups){for(n=0,m=b.settings.optgroups.length;m>n;n++){b.registerOptionGroup(b.settings.optgroups[n])}delete b.settings.optgroups}b.settings.mode=b.settings.mode||(1===b.settings.maxItems?"single":"multi"),"boolean"!=typeof b.settings.hideSelected&&(b.settings.hideSelected="multi"===b.settings.mode),b.initializePlugins(b.settings.plugins),b.setupCallbacks(),b.setupTemplates(),b.setup()};return au.mixin(M),aw.mixin(M),ay.extend(M.prototype,{setup:function(){var E,D,C,B,A,z,y,x,w,v=this,t=v.settings,s=v.eventNS,r=ay(window),f=ay(document),a=v.$input;if(y=v.settings.mode,x=a.attr("class")||"",E=ay("<div>").addClass(t.wrapperClass).addClass(x).addClass(y),D=ay("<div>").addClass(t.inputClass).addClass("items").appendTo(E),C=ay('<input type="text" autocomplete="off" />').appendTo(D).attr("tabindex",a.is(":disabled")?"-1":v.tabIndex),z=ay(t.dropdownParent||E),B=ay("<div>").addClass(t.dropdownClass).addClass(y).hide().appendTo(z),A=ay("<div>").addClass(t.dropdownContentClass).appendTo(B),v.settings.copyClassesToDropdown&&B.addClass(x),E.css({width:a[0].style.width}),v.plugins.names.length&&(w="plugin-"+v.plugins.names.join(" plugin-"),E.addClass(w),B.addClass(w)),(null===t.maxItems||t.maxItems>1)&&v.tagType===ac&&a.attr("multiple","multiple"),v.settings.placeholder&&C.attr("placeholder",t.placeholder),!v.settings.splitOn&&v.settings.delimiter){var F=v.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");v.settings.splitOn=new RegExp("\\s*"+F+"+\\s*")}a.attr("autocorrect")&&C.attr("autocorrect",a.attr("autocorrect")),a.attr("autocapitalize")&&C.attr("autocapitalize",a.attr("autocapitalize")),v.$wrapper=E,v.$control=D,v.$control_input=C,v.$dropdown=B,v.$dropdown_content=A,B.on("mouseenter","[data-selectable]",function(){return v.onOptionHover.apply(v,arguments)}),B.on("mousedown click","[data-selectable]",function(){return v.onOptionSelect.apply(v,arguments)}),R(D,"mousedown","*:not(input)",function(){return v.onItemSelect.apply(v,arguments)}),N(C),D.on({mousedown:function(){return v.onMouseDown.apply(v,arguments)},click:function(){return v.onClick.apply(v,arguments)}}),C.on({mousedown:function(b){b.stopPropagation()},keydown:function(){return v.onKeyDown.apply(v,arguments)},keyup:function(){return v.onKeyUp.apply(v,arguments)},keypress:function(){return v.onKeyPress.apply(v,arguments)},resize:function(){v.positionDropdown.apply(v,[])},blur:function(){return v.onBlur.apply(v,arguments)},focus:function(){return v.ignoreBlur=!1,v.onFocus.apply(v,arguments)},paste:function(){return v.onPaste.apply(v,arguments)}}),f.on("keydown"+s,function(b){v.isCmdDown=b[at?"metaKey":"ctrlKey"],v.isCtrlDown=b[at?"altKey":"ctrlKey"],v.isShiftDown=b.shiftKey}),f.on("keyup"+s,function(b){b.keyCode===ae&&(v.isCtrlDown=!1),b.keyCode===ag&&(v.isShiftDown=!1),b.keyCode===af&&(v.isCmdDown=!1)}),f.on("mousedown"+s,function(b){if(v.isFocused){if(b.target===v.$dropdown[0]||b.target.parentNode===v.$dropdown[0]){return !1}v.$control.has(b.target).length||b.target===v.$control[0]||v.blur(b.target)}}),r.on(["scroll"+s,"resize"+s].join(" "),function(){v.isOpen&&v.positionDropdown.apply(v,arguments)}),r.on("mousemove"+s,function(){v.ignoreHover=!1}),this.revertSettings={$children:a.children().detach(),tabindex:a.attr("tabindex")},a.attr("tabindex",-1).hide().after(v.$wrapper),ay.isArray(t.items)&&(v.setValue(t.items),delete t.items),aa&&a.on("invalid"+s,function(b){b.preventDefault(),v.isInvalid=!0,v.refreshState()}),v.updateOriginalInput(),v.refreshItems(),v.refreshState(),v.updatePlaceholder(),v.isSetup=!0,a.is(":disabled")&&v.disable(),v.on("change",this.onChange),a.data("selectize",v),a.addClass("selectized"),v.trigger("initialize"),t.preload===!0&&v.onSearchChange("")},setupTemplates:function(){var a=this,h=a.settings.labelField,g=a.settings.optgroupLabelField,f={optgroup:function(b){return'<div class="optgroup">'+b.html+"</div>"},optgroup_header:function(d,c){return'<div class="optgroup-header">'+c(d[g])+"</div>"},option:function(d,c){return'<div class="option">'+c(d[h])+"</div>"},item:function(d,c){return'<div class="item">'+c(d[h])+"</div>"},option_create:function(d,c){return'<div class="create">Inserindo: &quot;<strong>'+c(d.input)+"</strong>&quot;</div>"}};a.settings.render=ay.extend({},f,a.settings.render)},setupCallbacks:function(){var e,d,f={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in f){f.hasOwnProperty(e)&&(d=this.settings[f[e]],d&&this.on(e,d))}},onClick:function(d){var c=this;c.isFocused||(c.focus(),d.preventDefault())},onMouseDown:function(a){var f=this,e=a.isDefaultPrevented();ay(a.target);if(f.isFocused){if(a.target!==f.$control_input[0]){return"single"===f.settings.mode?f.isOpen?f.close():f.open():e||f.setActiveItem(null),!1}}else{e||window.setTimeout(function(){f.focus()},0)}},onChange:function(){this.$input.trigger("change")},onPaste:function(a){var d=this;d.isFull()||d.isInputHidden||d.isLocked?a.preventDefault():d.settings.splitOn&&setTimeout(function(){for(var c=ay.trim(d.$control_input.val()||"").split(d.settings.splitOn),g=0,f=c.length;f>g;g++){d.createItem(c[g])}},0)},onKeyPress:function(d){if(this.isLocked){return d&&d.preventDefault()}var c=String.fromCharCode(d.keyCode||d.which);return this.settings.create&&"multi"===this.settings.mode&&c===this.settings.delimiter?(this.createItem(),d.preventDefault(),!1):void 0},onKeyDown:function(f){var e=(f.target===this.$control_input[0],this);if(e.isLocked){return void (f.keyCode!==ad&&f.preventDefault())}switch(f.keyCode){case ar:if(e.isCmdDown){return void e.selectAll()}break;case ap:return void (e.isOpen&&(f.preventDefault(),f.stopPropagation(),e.close()));case aj:if(!f.ctrlKey||f.altKey){break}case ak:if(!e.isOpen&&e.hasOptions){e.open()}else{if(e.$activeOption){e.ignoreHover=!0;var h=e.getAdjacentOption(e.$activeOption,1);h.length&&e.setActiveOption(h,!0,!0)}}return void f.preventDefault();case am:if(!f.ctrlKey||f.altKey){break}case an:if(e.$activeOption){e.ignoreHover=!0;var g=e.getAdjacentOption(e.$activeOption,-1);g.length&&e.setActiveOption(g,!0,!0)}return void f.preventDefault();case aq:return void (e.isOpen&&e.$activeOption&&(e.onOptionSelect({currentTarget:e.$activeOption}),f.preventDefault()));case ao:return void e.advanceSelection(-1,f);case al:return void e.advanceSelection(1,f);case ad:return e.settings.selectOnTab&&e.isOpen&&e.$activeOption&&(e.onOptionSelect({currentTarget:e.$activeOption}),e.isFull()||f.preventDefault()),void (e.settings.create&&e.createItem()&&f.preventDefault());case ai:case ah:return void e.deleteSelection(f)}return !e.isFull()&&!e.isInputHidden||(at?f.metaKey:f.ctrlKey)?void 0:void f.preventDefault()},onKeyUp:function(e){var d=this;if(d.isLocked){return e&&e.preventDefault()}var f=d.$control_input.val()||"";d.lastValue!==f&&(d.lastValue=f,d.onSearchChange(f),d.refreshOptions(),d.trigger("type",f))},onSearchChange:function(e){var d=this,f=d.settings.load;f&&(d.loadedSearches.hasOwnProperty(e)||(d.loadedSearches[e]=!0,d.load(function(a){f.apply(d,[e,a])})))},onFocus:function(e){var d=this,f=d.isFocused;return d.isDisabled?(d.blur(),e&&e.preventDefault(),!1):void (d.ignoreFocus||(d.isFocused=!0,"focus"===d.settings.preload&&d.onSearchChange(""),f||d.trigger("focus"),d.$activeItems.length||(d.showInput(),d.setActiveItem(null),d.refreshOptions(!!d.settings.openOnFocus)),d.refreshState()))},onBlur:function(f,e){var h=this;if(h.isFocused&&(h.isFocused=!1,!h.ignoreFocus)){if(!h.ignoreBlur&&document.activeElement===h.$dropdown_content[0]){return h.ignoreBlur=!0,void h.onFocus(f)}var g=function(){h.close(),h.setTextboxValue(""),h.setActiveItem(null),h.setActiveOption(null),h.setCaret(h.items.length),h.refreshState(),(e||document.body).focus(),h.ignoreFocus=!1,h.trigger("blur")};h.ignoreFocus=!0,h.settings.create&&h.settings.createOnBlur?h.createItem(null,!1,g):g()}},onOptionHover:function(b){this.ignoreHover||this.setActiveOption(b.currentTarget,!1)},onOptionSelect:function(a){var h,g,f=this;a.preventDefault&&(a.preventDefault(),a.stopPropagation()),g=ay(a.currentTarget),g.hasClass("create")?f.createItem(null,function(){f.settings.closeAfterSelect&&f.close()}):(h=g.attr("data-value"),"undefined"!=typeof h&&(f.lastQuery=null,f.setTextboxValue(""),f.addItem(h),f.settings.closeAfterSelect?f.close():!f.settings.hideSelected&&a.type&&/mouse/.test(a.type)&&f.setActiveOption(f.getOption(h))))},onItemSelect:function(d){var c=this;c.isLocked||"multi"===c.settings.mode&&(d.preventDefault(),c.setActiveItem(d.currentTarget,d))},load:function(e){var d=this,f=d.$wrapper.addClass(d.settings.loadingClass);d.loading++,e.apply(d,[function(b){d.loading=Math.max(d.loading-1,0),b&&b.length&&(d.addOption(b),d.refreshOptions(d.isFocused&&!d.isInputHidden)),d.loading||f.removeClass(d.settings.loadingClass),d.trigger("load",b)}])},setTextboxValue:function(e){var d=this.$control_input,f=d.val()!==e;f&&(d.val(e).triggerHandler("update"),this.lastValue=e)},getValue:function(){return this.tagType===ac&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(e,d){var f=d?[]:["change"];S(this,f,function(){this.clear(d),this.addItems(e,d)})},setActiveItem:function(v,u){var t,s,r,q,p,o,n,m,a=this;if("single"!==a.settings.mode){if(v=ay(v),!v.length){return ay(a.$activeItems).removeClass("active"),a.$activeItems=[],void (a.isFocused&&a.showInput())}if(t=u&&u.type.toLowerCase(),"mousedown"===t&&a.isShiftDown&&a.$activeItems.length){for(m=a.$control.children(".active:last"),q=Array.prototype.indexOf.apply(a.$control[0].childNodes,[m[0]]),p=Array.prototype.indexOf.apply(a.$control[0].childNodes,[v[0]]),q>p&&(n=q,q=p,p=n),s=q;p>=s;s++){o=a.$control[0].childNodes[s],-1===a.$activeItems.indexOf(o)&&(ay(o).addClass("active"),a.$activeItems.push(o))}u.preventDefault()}else{"mousedown"===t&&a.isCtrlDown||"keydown"===t&&this.isShiftDown?v.hasClass("active")?(r=a.$activeItems.indexOf(v[0]),a.$activeItems.splice(r,1),v.removeClass("active")):a.$activeItems.push(v.addClass("active")[0]):(ay(a.$activeItems).removeClass("active"),a.$activeItems=[v.addClass("active")[0]])}a.hideInput(),this.isFocused||a.focus()}},setActiveOption:function(r,q,p){var o,n,m,l,k,a=this;a.$activeOption&&a.$activeOption.removeClass("active"),a.$activeOption=null,r=ay(r),r.length&&(a.$activeOption=r.addClass("active"),(q||!Z(q))&&(o=a.$dropdown_content.height(),n=a.$activeOption.outerHeight(!0),q=a.$dropdown_content.scrollTop()||0,m=a.$activeOption.offset().top-a.$dropdown_content.offset().top+q,l=m,k=m-o+n,m+n>o+q?a.$dropdown_content.stop().animate({scrollTop:k},p?a.settings.scrollDuration:0):q>m&&a.$dropdown_content.stop().animate({scrollTop:l},p?a.settings.scrollDuration:0)))},selectAll:function(){var b=this;"single"!==b.settings.mode&&(b.$activeItems=Array.prototype.slice.apply(b.$control.children(":not(input)").addClass("active")),b.$activeItems.length&&(b.hideInput(),b.close()),b.focus())},hideInput:function(){var b=this;b.setTextboxValue(""),b.$control_input.css({opacity:0,position:"absolute",left:b.rtl?10000:-10000}),b.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var b=this;b.isDisabled||(b.ignoreFocus=!0,b.$control_input[0].focus(),window.setTimeout(function(){b.ignoreFocus=!1,b.onFocus()},0))},blur:function(b){this.$control_input[0].blur(),this.onBlur(null,b)},getScoreFunction:function(b){return this.sifter.getScoreFunction(b,this.getSearchOptions())},getSearchOptions:function(){var d=this.settings,c=d.sortField;return"string"==typeof c&&(c=[{field:c}]),{fields:d.searchField,conjunction:d.searchConjunction,sort:c}},search:function(a){var n,m,l,k=this,j=k.settings,i=this.getSearchOptions();if(j.score&&(l=k.settings.score.apply(this,[a]),"function"!=typeof l)){throw new Error('Selectize "score" setting must be a function that returns a function')}if(a!==k.lastQuery?(k.lastQuery=a,m=k.sifter.search(a,ay.extend(i,{score:l})),k.currentResults=m):m=ay.extend(!0,{},k.currentResults),j.hideSelected){for(n=m.items.length-1;n>=0;n--){-1!==k.items.indexOf(Y(m.items[n].id))&&m.items.splice(n,1)}}return m},refreshOptions:function(aE){var aD,aC,aB,aA,az,L,K,J,I,H,G,F,E,D,C,B;"undefined"==typeof aE&&(aE=!0);var A=this,z=ay.trim(A.$control_input.val()),y=A.search(z),d=A.$dropdown_content,a=A.$activeOption&&Y(A.$activeOption.attr("data-value"));for(aA=y.items.length,"number"==typeof A.settings.maxOptions&&(aA=Math.min(aA,A.settings.maxOptions)),az={},L=[],aD=0;aA>aD;aD++){for(K=A.options[y.items[aD].id],J=A.render("option",K),I=K[A.settings.optgroupField]||"",H=ay.isArray(I)?I:[I],aC=0,aB=H&&H.length;aB>aC;aC++){I=H[aC],A.optgroups.hasOwnProperty(I)||(I=""),az.hasOwnProperty(I)||(az[I]=[],L.push(I)),az[I].push(J)}}for(this.settings.lockOptgroupOrder&&L.sort(function(f,e){var h=A.optgroups[f].$order||0,g=A.optgroups[e].$order||0;return h-g}),G=[],aD=0,aA=L.length;aA>aD;aD++){I=L[aD],A.optgroups.hasOwnProperty(I)&&az[I].length?(F=A.render("optgroup_header",A.optgroups[I])||"",F+=az[I].join(""),G.push(A.render("optgroup",ay.extend({},A.optgroups[I],{html:F})))):G.push(az[I].join(""))}if(d.html(G.join("")),A.settings.highlight&&y.query.length&&y.tokens.length){for(aD=0,aA=y.tokens.length;aA>aD;aD++){av(d,y.tokens[aD].regex)}}if(!A.settings.hideSelected){for(aD=0,aA=A.items.length;aA>aD;aD++){A.getOption(A.items[aD]).addClass("selected")}}E=A.canCreate(z),E&&(d.prepend(A.render("option_create",{input:z})),B=ay(d[0].childNodes[0])),A.hasOptions=y.items.length>0||E,A.hasOptions?(y.items.length>0?(C=a&&A.getOption(a),C&&C.length?D=C:"single"===A.settings.mode&&A.items.length&&(D=A.getOption(A.items[0])),D&&D.length||(D=B&&!A.settings.addPrecedence?A.getAdjacentOption(B,1):d.find("[data-selectable]:first"))):D=B,A.setActiveOption(D),aE&&!A.isOpen&&A.open()):(A.setActiveOption(null),aE&&A.isOpen&&A.close())},addOption:function(a){var j,i,h,g=this;if(ay.isArray(a)){for(j=0,i=a.length;i>j;j++){g.addOption(a[j])}}else{(h=g.registerOption(a))&&(g.userOptions[h]=!0,g.lastQuery=null,g.trigger("option_add",h,a))}},registerOption:function(d){var c=Y(d[this.settings.valueField]);return !c||this.options.hasOwnProperty(c)?!1:(d.$order=d.$order||++this.order,this.options[c]=d,c)},registerOptionGroup:function(d){var c=Y(d[this.settings.optgroupValueField]);return c?(d.$order=d.$order||++this.order,this.optgroups[c]=d,c):!1},addOptionGroup:function(d,c){c[this.settings.optgroupValueField]=d,(d=this.registerOptionGroup(c))&&this.trigger("optgroup_add",d,c)},removeOptionGroup:function(b){this.optgroups.hasOwnProperty(b)&&(delete this.optgroups[b],this.renderCache={},this.trigger("optgroup_remove",b))},clearOptionGroups:function(){this.optgroups={},this.renderCache={},this.trigger("optgroup_clear")},updateOption:function(t,s){var r,q,p,o,n,m,l,a=this;if(t=Y(t),p=Y(s[a.settings.valueField]),null!==t&&a.options.hasOwnProperty(t)){if("string"!=typeof p){throw new Error("Value must be set in option data")}l=a.options[t].$order,p!==t&&(delete a.options[t],o=a.items.indexOf(t),-1!==o&&a.items.splice(o,1,p)),s.$order=s.$order||l,a.options[p]=s,n=a.renderCache.item,m=a.renderCache.option,n&&(delete n[t],delete n[p]),m&&(delete m[t],delete m[p]),-1!==a.items.indexOf(p)&&(r=a.getItem(t),q=ay(a.render("item",s)),r.hasClass("active")&&q.addClass("active"),r.replaceWith(q)),a.lastQuery=null,a.isOpen&&a.refreshOptions(!1)}},removeOption:function(g,f){var j=this;g=Y(g);var i=j.renderCache.item,h=j.renderCache.option;i&&delete i[g],h&&delete h[g],delete j.userOptions[g],delete j.options[g],j.lastQuery=null,j.trigger("option_remove",g),j.removeItem(g,f)},clearOptions:function(){var b=this;b.loadedSearches={},b.userOptions={},b.renderCache={},b.options=b.sifter.items={},b.lastQuery=null,b.trigger("option_clear"),b.clear()},getOption:function(b){return this.getElementWithValue(b,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(a,h){var g=this.$dropdown.find("[data-selectable]"),f=g.index(a)+h;return f>=0&&f<g.length?g.eq(f):ay()},getElementWithValue:function(a,h){if(a=Y(a),"undefined"!=typeof a&&null!==a){for(var g=0,f=h.length;f>g;g++){if(h[g].getAttribute("data-value")===a){return ay(h[g])}}}return ay()},getItem:function(b){return this.getElementWithValue(b,this.$control.children())},addItems:function(a,j){for(var i=ay.isArray(a)?a:[a],h=0,g=i.length;g>h;h++){this.isPending=g-1>h,this.addItem(i[h],j)}},addItem:function(a,f){var e=f?[]:["change"];S(this,e,function(){var o,n,m,l,k,c=this,b=c.settings.mode;return a=Y(a),-1!==c.items.indexOf(a)?void ("single"===b&&c.close()):void (c.options.hasOwnProperty(a)&&("single"===b&&c.clear(f),"multi"===b&&c.isFull()||(o=ay(c.render("item",c.options[a])),k=c.isFull(),c.items.splice(c.caretPos,0,a),c.insertAtCaret(o),(!c.isPending||!k&&c.isFull())&&c.refreshState(),c.isSetup&&(m=c.$dropdown_content.find("[data-selectable]"),c.isPending||(n=c.getOption(a),l=c.getAdjacentOption(n,1).attr("data-value"),c.refreshOptions(c.isFocused&&"single"!==b),l&&c.setActiveOption(c.getOption(l))),!m.length||c.isFull()?c.close():c.positionDropdown(),c.updatePlaceholder(),c.trigger("item_add",a,o),c.updateOriginalInput({silent:f})))))})},removeItem:function(h,g){var l,k,j,i=this;l="object"==typeof h?h:i.getItem(h),h=Y(l.attr("data-value")),k=i.items.indexOf(h),-1!==k&&(l.remove(),l.hasClass("active")&&(j=i.$activeItems.indexOf(l[0]),i.$activeItems.splice(j,1)),i.items.splice(k,1),i.lastQuery=null,!i.settings.persist&&i.userOptions.hasOwnProperty(h)&&i.removeOption(h,g),k<i.caretPos&&i.setCaret(i.caretPos-1),i.refreshState(),i.updatePlaceholder(),i.updateOriginalInput({silent:g}),i.positionDropdown(),i.trigger("item_remove",h,l))},createItem:function(a,p){var o=this,n=o.caretPos;a=a||ay.trim(o.$control_input.val()||"");var m=arguments[arguments.length-1];if("function"!=typeof m&&(m=function(){}),"boolean"!=typeof p&&(p=!0),!o.canCreate(a)){return m(),!1}o.lock();var l="function"==typeof o.settings.create?this.settings.create:function(d){var c={};return c[o.settings.labelField]=d,c[o.settings.valueField]=d,c},k=U(function(d){if(o.unlock(),!d||"object"!=typeof d){return m()}var c=Y(d[o.settings.valueField]);return"string"!=typeof c?m():(o.setTextboxValue(""),o.addOption(d),o.setCaret(n),o.addItem(c),o.refreshOptions(p&&"single"!==o.settings.mode),void m(d))}),j=l.apply(this,[a,k]);return"undefined"!=typeof j&&k(j),!0},refreshItems:function(){this.lastQuery=null,this.isSetup&&this.addItem(this.items),this.refreshState(),this.updateOriginalInput()},refreshState:function(){var d,c=this;c.isRequired&&(c.items.length&&(c.isInvalid=!1),c.$control_input.prop("required",d)),c.refreshClasses()},refreshClasses:function(){var a=this,f=a.isFull(),e=a.isLocked;a.$wrapper.toggleClass("rtl",a.rtl),a.$control.toggleClass("focus",a.isFocused).toggleClass("disabled",a.isDisabled).toggleClass("required",a.isRequired).toggleClass("invalid",a.isInvalid).toggleClass("locked",e).toggleClass("full",f).toggleClass("not-full",!f).toggleClass("input-active",a.isFocused&&!a.isInputHidden).toggleClass("dropdown-active",a.isOpen).toggleClass("has-options",!ay.isEmptyObject(a.options)).toggleClass("has-items",a.items.length>0),a.$control_input.data("grow",!f&&!e)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(h){var g,l,k,j,i=this;if(h=h||{},i.tagType===ac){for(k=[],g=0,l=i.items.length;l>g;g++){j=i.options[i.items[g]][i.settings.labelField]||"",k.push('<option value="'+X(i.items[g])+'" selected="selected">'+X(j)+"</option>")}k.length||this.$input.attr("multiple")||k.push('<option value="" selected="selected"></option>'),i.$input.html(k.join(""))}else{i.$input.val(i.getValue()),i.$input.attr("value",i.$input.val())}i.isSetup&&(h.silent||i.trigger("change",i.$input.val()))},updatePlaceholder:function(){if(this.settings.placeholder){var b=this.$control_input;this.items.length?b.removeAttr("placeholder"):b.attr("placeholder",this.settings.placeholder),b.triggerHandler("update",{force:!0})}},open:function(){var b=this;b.isLocked||b.isOpen||"multi"===b.settings.mode&&b.isFull()||(b.focus(),b.isOpen=!0,b.refreshState(),b.$dropdown.css({visibility:"hidden",display:"block"}),b.positionDropdown(),b.$dropdown.css({visibility:"visible"}),b.trigger("dropdown_open",b.$dropdown))},close:function(){var d=this,c=d.isOpen;"single"===d.settings.mode&&d.items.length&&d.hideInput(),d.isOpen=!1,d.$dropdown.hide(),d.setActiveOption(null),d.refreshState(),c&&d.trigger("dropdown_close",d.$dropdown)},positionDropdown:function(){var d=this.$control,c="body"===this.settings.dropdownParent?d.offset():d.position();c.top+=d.outerHeight(!0),this.$dropdown.css({width:d.outerWidth(),top:c.top,left:c.left})},clear:function(d){var c=this;c.items.length&&(c.$control.children(":not(input)").remove(),c.items=[],c.lastQuery=null,c.setCaret(0),c.setActiveItem(null),c.updatePlaceholder(),c.updateOriginalInput({silent:d}),c.refreshState(),c.showInput(),c.trigger("clear"))},insertAtCaret:function(a){var d=Math.min(this.caretPos,this.items.length);0===d?this.$control.prepend(a):ay(this.$control[0].childNodes[d]).before(a),this.setCaret(d+1)},deleteSelection:function(v){var u,t,s,r,q,p,o,n,m,a=this;if(s=v&&v.keyCode===ai?-1:1,r=Q(a.$control_input[0]),a.$activeOption&&!a.settings.hideSelected&&(o=a.getAdjacentOption(a.$activeOption,-1).attr("data-value")),q=[],a.$activeItems.length){for(m=a.$control.children(".active:"+(s>0?"last":"first")),p=a.$control.children(":not(input)").index(m),s>0&&p++,u=0,t=a.$activeItems.length;t>u;u++){q.push(ay(a.$activeItems[u]).attr("data-value"))}v&&(v.preventDefault(),v.stopPropagation())}else{(a.isFocused||"single"===a.settings.mode)&&a.items.length&&(0>s&&0===r.start&&0===r.length?q.push(a.items[a.caretPos-1]):s>0&&r.start===a.$control_input.val().length&&q.push(a.items[a.caretPos]))}if(!q.length||"function"==typeof a.settings.onDelete&&a.settings.onDelete.apply(a,[q])===!1){return !1}for("undefined"!=typeof p&&a.setCaret(p);q.length;){a.removeItem(q.pop())}return a.showInput(),a.positionDropdown(),a.refreshOptions(!0),o&&(n=a.getOption(o),n.length&&a.setActiveOption(n)),!0},advanceSelection:function(r,q){var p,o,n,m,l,k,j=this;0!==r&&(j.rtl&&(r*=-1),p=r>0?"last":"first",o=Q(j.$control_input[0]),j.isFocused&&!j.isInputHidden?(m=j.$control_input.val().length,l=0>r?0===o.start&&0===o.length:o.start===m,l&&!m&&j.advanceCaret(r,q)):(k=j.$control.children(".active:"+p),k.length&&(n=j.$control.children(":not(input)").index(k),j.setActiveItem(null),j.setCaret(r>0?n+1:n))))},advanceCaret:function(g,f){var j,i,h=this;0!==g&&(j=g>0?"next":"prev",h.isShiftDown?(i=h.$control_input[j](),i.length&&(h.hideInput(),h.setActiveItem(i),f&&f.preventDefault())):h.setCaret(h.caretPos+g))},setCaret:function(a){var l=this;if(a="single"===l.settings.mode?l.items.length:Math.max(0,Math.min(l.items.length,a)),!l.isPending){var k,j,i,h;for(i=l.$control.children(":not(input)"),k=0,j=i.length;j>k;k++){h=ay(i[k]).detach(),a>k?l.$control_input.before(h):l.$control.append(h)}}l.caretPos=a},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){var b=this;b.$input.prop("disabled",!0),b.$control_input.prop("disabled",!0).prop("tabindex",-1),b.isDisabled=!0,b.lock()},enable:function(){var b=this;b.$input.prop("disabled",!1),b.$control_input.prop("disabled",!1).prop("tabindex",b.tabIndex),b.isDisabled=!1,b.unlock()},destroy:function(){var a=this,f=a.eventNS,e=a.revertSettings;a.trigger("destroy"),a.off(),a.$wrapper.remove(),a.$dropdown.remove(),a.$input.html("").append(e.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:e.tabindex}).show(),a.$control_input.removeData("grow"),a.$input.removeData("selectize"),ay(window).off(f),ay(document).off(f),ay(document.body).off(f),delete a.$input[0].selectize},render:function(j,i){var p,o,n="",m=!1,l=this,k=/^[\t \r\n]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;return("option"===j||"item"===j)&&(p=Y(i[l.settings.valueField]),m=!!p),m&&(Z(l.renderCache[j])||(l.renderCache[j]={}),l.renderCache[j].hasOwnProperty(p))?l.renderCache[j][p]:(n=l.settings.render[j].apply(this,[i,X]),("option"===j||"option_create"===j)&&(n=n.replace(k,"<$1 data-selectable")),"optgroup"===j&&(o=i[l.settings.optgroupValueField]||"",n=n.replace(k,'<$1 data-group="'+W(X(o))+'"')),("option"===j||"item"===j)&&(n=n.replace(k,'<$1 data-value="'+W(X(p||""))+'"')),m&&(l.renderCache[j][p]=n),n)},clearCache:function(d){var c=this;"undefined"==typeof d?c.renderCache={}:delete c.renderCache[d]},canCreate:function(e){var d=this;if(!d.settings.create){return !1}var f=d.settings.createFilter;return !(!e.length||"function"==typeof f&&!f.apply(d,[e])||"string"==typeof f&&!new RegExp(f).test(e)||f instanceof RegExp&&!f.test(e))}}),M.count=0,M.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1000,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,closeAfterSelect:!1,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}},ay.fn.selectize=function(v){var u=ay.fn.selectize.defaults,t=ay.extend({},u,v),s=t.dataAttr,r=t.labelField,q=t.valueField,p=t.optgroupField,o=t.optgroupLabelField,n=t.optgroupValueField,m=function(e,z){var y,x,w,g,f=e.attr(s);if(f){for(z.options=JSON.parse(f),y=0,x=z.options.length;x>y;y++){z.items.push(z.options[y][q])}}else{var d=ay.trim(e.val()||"");if(!t.allowEmptyOption&&!d.length){return}for(w=d.split(t.delimiter),y=0,x=w.length;x>y;y++){g={},g[r]=w[y],g[q]=w[y],z.options.push(g)}z.items=w}},a=function(y,x){var w,j,i,h,g=x.options,f={},e=function(k){var c=s&&k.attr(s);return"string"==typeof c&&c.length?JSON.parse(c):null},d=function(c,C){c=ay(c);var B=Y(c.attr("value"));if(B||t.allowEmptyOption){if(f.hasOwnProperty(B)){if(C){var A=f[B][p];A?ay.isArray(A)?A.push(C):f[B][p]=[A,C]:f[B][p]=C}}else{var l=e(c)||{};l[r]=l[r]||c.text(),l[q]=l[q]||B,l[p]=l[p]||C,f[B]=l,g.push(l),c.is(":selected")&&x.items.push(B)}}},z=function(c){var C,B,A,l,k;for(c=ay(c),A=c.attr("label"),A&&(l=e(c)||{},l[o]=A,l[n]=A,x.optgroups.push(l)),k=ay("option",c),C=0,B=k.length;B>C;C++){d(k[C],A)}};for(x.maxItems=y.attr("multiple")?null:1,h=y.children(),w=0,j=h.length;j>w;w++){i=h[w].tagName.toLowerCase(),"optgroup"===i?z(h[w]):"option"===i&&d(h[w])}};return this.each(function(){if(!this.selectize){var k,j=ay(this),d=this.tagName.toLowerCase(),c=j.attr("placeholder")||j.attr("data-placeholder");c||t.allowEmptyOption||(c=j.children('option[value=""]').text());var b={placeholder:c,options:[],optgroups:[],items:[]};"select"===d?a(j,b):m(j,b),k=new M(j,ay.extend(!0,{},u,b,v))}})},ay.fn.selectize.defaults=M.defaults,ay.fn.selectize.support={validity:aa},M.define("drag_drop",function(){if(!ay.fn.sortable){throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".')}if("multi"===this.settings.mode){var a=this;a.lock=function(){var b=a.lock;return function(){var d=a.$control.data("sortable");return d&&d.disable(),b.apply(a,arguments)}}(),a.unlock=function(){var b=a.unlock;return function(){var d=a.$control.data("sortable");return d&&d.enable(),b.apply(a,arguments)}}(),a.setup=function(){var b=a.setup;return function(){b.apply(this,arguments);var c=a.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:a.isLocked,start:function(e,d){d.placeholder.css("width",d.helper.css("width")),c.css({overflow:"visible"})},stop:function(){c.css({overflow:"hidden"});var f=a.$activeItems?a.$activeItems.slice():null,d=[];c.children("[data-value]").each(function(){d.push(ay(this).attr("data-value"))}),a.setValue(d),a.setActiveItem(f)}})}}()}}),M.define("dropdown_header",function(a){var d=this;a=ay.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(b){return'<div class="'+b.headerClass+'"><div class="'+b.titleRowClass+'"><span class="'+b.labelClass+'">'+b.title+'</span><a href="javascript:void(0)" class="'+b.closeClass+'">&times;</a></div></div>'}},a),d.setup=function(){var b=d.setup;return function(){b.apply(d,arguments),d.$dropdown_header=ay(a.html(a)),d.$dropdown.prepend(d.$dropdown_header)}}()}),M.define("optgroup_columns",function(a){var h=this;a=ay.extend({equalizeWidth:!0,equalizeHeight:!0},a),this.getAdjacentOption=function(i,l){var k=i.closest("[data-group]").find("[data-selectable]"),j=k.index(i)+l;return j>=0&&j<k.length?k.eq(j):ay()},this.onKeyDown=function(){var b=h.onKeyDown;return function(c){var l,k,j,i;return !this.isOpen||c.keyCode!==ao&&c.keyCode!==al?b.apply(this,arguments):(h.ignoreHover=!0,i=this.$activeOption.closest("[data-group]"),l=i.find("[data-selectable]").index(this.$activeOption),i=c.keyCode===ao?i.prev("[data-group]"):i.next("[data-group]"),j=i.find("[data-selectable]"),k=j.eq(Math.min(j.length-1,l)),void (k.length&&this.setActiveOption(k)))}}();var g=function(){var e,d=g.width,i=document;return"undefined"==typeof d&&(e=i.createElement("div"),e.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',e=e.firstChild,i.body.appendChild(e),d=g.width=e.offsetWidth-e.clientWidth,i.body.removeChild(e)),d},f=function(){var o,n,m,l,d,c,b;if(b=ay("[data-group]",h.$dropdown_content),n=b.length,n&&h.$dropdown_content.width()){if(a.equalizeHeight){for(m=0,o=0;n>o;o++){m=Math.max(m,b.eq(o).height())}b.css({height:m})}a.equalizeWidth&&(c=h.$dropdown_content.innerWidth()-g(),l=Math.round(c/n),b.css({width:l}),n>1&&(d=c-l*(n-1),b.eq(n-1).css({width:d})))}};(a.equalizeHeight||a.equalizeWidth)&&(V.after(this,"positionDropdown",f),V.after(this,"refreshOptions",f))}),M.define("remove_button",function(a){if("single"!==this.settings.mode){a=ay.extend({label:"&times;",title:"Remove",className:"remove",append:!0},a);var h=this,g='<a href="javascript:void(0)" class="'+a.className+'" tabindex="-1" title="'+X(a.title)+'">'+a.label+"</a>",f=function(e,d){var i=e.search(/(<\/[^>]+>\s*)$/);return e.substring(0,i)+d+e.substring(i)};this.setup=function(){var b=h.setup;return function(){if(a.append){var c=h.settings.render.item;h.settings.render.item=function(){return f(c.apply(this,arguments),g)}}b.apply(this,arguments),this.$control.on("click","."+a.className,function(e){if(e.preventDefault(),!h.isLocked){var i=ay(e.currentTarget).parent();h.setActiveItem(i),h.deleteSelection()&&h.setCaret(h.items.length)}})}}()}}),M.define("restore_on_backspace",function(d){var c=this;d.text=d.text||function(b){return b[this.settings.labelField]},this.onKeyDown=function(){var a=c.onKeyDown;return function(f){var h,g;return f.keyCode===ai&&""===this.$control_input.val()&&!this.$activeItems.length&&(h=this.caretPos-1,h>=0&&h<this.items.length)?(g=this.options[this.items[h]],this.deleteSelection(f)&&(this.setTextboxValue(d.text.apply(this,[g])),this.refreshOptions(!0)),void f.preventDefault()):a.apply(this,arguments)}}()}),M});