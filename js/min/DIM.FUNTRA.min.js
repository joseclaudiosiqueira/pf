
function consultaFuncaoTransacaoBaseline(c,a){$.post("/pf/DIM.Gateway.php",{i:c,b:a,arq:44,tch:1,sub:-1,dlg:1},function(b){var e=Number(b[0].pfa);var d=Number(b[0].pfb);$("#transacao_id").val(ac=="al"?b[0].id:0);$("#transacao_td").val(b[0].td);$("#transacao_ar").val(b[0].ar);$("#transacao_complexidade").val(b[0].complexidade);$("#transacao_fonte").val(b[0].fonte);$("#transacao_metodo").val(b[0].id_metodo);$("#id_fator_tecnologia").val(b[0].id_fator_tecnologia);$("#valor_fator_tecnologia").html(parseFloat(b[0].valor_fator_tecnologia).toFixed(3));verificaMetodo("transacao",$("#transacao_metodo"),$("#transacao_id_roteiro"),$("#transacao_operacao"));$("#transacao_pfb").val(d.toFixed(4));$("#transacao_impacto").val(0);$("#transacao_observacoes").val(b[0].obs_funcao);$("#transacao_observacoes_validacao").val(b[0].obs_validar);arrAR=b[0].descricaoAR;jQuery("#transacao_descricao_ar").tagsManager("empty");for(x=0;x<arrAR.length;x++){jQuery("#transacao_descricao_ar").tagsManager("pushTag",arrAR[x])}arrTD=b[0].descricaoTD;jQuery("#transacao_descricao_td").tagsManager("empty");for(x=0;x<arrTD.length;x++){jQuery("#transacao_descricao_td").tagsManager("pushTag",arrTD[x])}detalheItem(b[0].selImpacto,"transacao");if($("#transacao_operacao").val()==="A"||$("#transacao_operacao").val()==="E"){$("#transacao-is-mudanca").bootstrapToggle("enable").bootstrapToggle("off")}$(".tm-tag-remove").css({visibility:(!isAutorizadoAlterar?"hidden":"visible")})},"json")}function retornaFuncaoTransacao(c,a,d,e,f){acForms="al";fAtual=a;$.post("/pf/DIM.Gateway.php",{i:c,b:a,arq:44,tch:1,sub:-1,dlg:1},function(b){$("#form_modal_funcao_transacao").modal("toggle");if(a==="EE"){$("#cabecalho_funcao").val(title_ee_alt);$("#transacao_h4-modal").html(title_ee_alt);$("#transacao_tabela").val("EE")}else{if(a==="SE"){$("#cabecalho_funcao").val(title_se_alt);$("#transacao_h4-modal").html(title_se_alt);$("#transacao_tabela").val("SE")}else{if(a==="CE"){$("#cabecalho_funcao").val(title_ce_alt);$("#transacao_h4-modal").html(title_ce_alt);$("#transacao_tabela").val("CE")}}}$("#transacao_qtd_atual").val(d);$("#transacao_id").val(c);$("#transacao_id_roteiro").val(b[0].id_roteiro);idRoteiro=b[0].id_roteiro;idRoteiro==3?$("#transacao_id_roteiro").prop("disabled",false):$("#transacao_id_roteiro").prop("disabled",true);$("#transacao_operacao").val(b[0].operacao);$("#transacao_metodo").val(b[0].id_metodo);$("#transacao_entrega").val(b[0].entrega).mask("00").TouchSpin({min:1,max:$("#entregas").val(),step:1,boostat:5,maxboostedstep:10,postfix:""}).prop("readonly",true);verificaOperacao("transacao",b[0].operacao,b[0].id_roteiro,b[0].selImpacto,a,acForms);verificaMetodo("transacao",$("#transacao_metodo"),$("#transacao_id_roteiro"),$("#transacao_operacao"));if(b[0].operacao==="T"){$("#transacao_op1").prop("disabled",true);$("#transacao_op2").prop("disabled",true);$("#transacao_op3").prop("disabled",true);$("#transacao_me1").prop("disabled",true);$("#transacao_me2").prop("disabled",true)}if(abAtual==3){$("#transacao_me1").prop("disabled",true);$("#transacao_me2").prop("disabled",true)}situacaoLinha=b[0].situacao;$("#transacao_fd").val(b[0].fd);if(b[0].operacao!=="I"&&b[0].operacao!=="T"&&b[0].tipoImpacto==="A"){$("#transacao_fd").prop("disabled",false)}$("#transacao_funcao").val(b[0].funcao).prop("readonly",b[0].operacao==="T"?true:false);$("#transacao_td").val(b[0].td);$("#transacao_ar").val(b[0].ar);$("#transacao_complexidade").val(b[0].complexidade);var g=Number(b[0].pfb);$("#transacao_pfb").val(g.toFixed(4));var h=Number(b[0].pfa);$("#transacao_pfa").val(h.toFixed(4));$("#transacao_observacoes").val(b[0].obs_funcao);$("#transacao_observacoes_validacao").val(b[0].obs_validar);$("#transacao_entrega").val(b[0].entrega);$("#id_fator_tecnologia").val(b[0].idFatorTecnologia);$("#valor_fator_tecnologia").html(parseFloat(b[0].valorFatorTecnologia).toFixed(3));arrAR=b[0].descricaoAR;for(x=0;x<arrAR.length;x++){jQuery("#transacao_descricao_ar").tagsManager("pushTag",arrAR[x])}arrTD=b[0].descricaoTD;for(x=0;x<arrTD.length;x++){jQuery("#transacao_descricao_td").tagsManager("pushTag",arrTD[x])}$("#transacao_fonte").val(b[0].fonte);if(b[0].isMudanca==1){$("#transacao-is-mudanca").bootstrapToggle("enable").bootstrapToggle("on");$("#transacao-fase").val(b[0].faseMudanca);$("#transacao-percentual-fase").val(b[0].percentualFase==0?"":b[0].percentualFase).prop("readonly",false)}else{if(b[0].operacao!=="I"&&b[0].operacao!=="T"){$("#transacao-is-mudanca").bootstrapToggle("enable");$("#transacao-fase").val(0);$("#transacao-percentual-fase").val("").prop("readonly",true)}else{$("#transacao-is-mudanca").bootstrapToggle("off").bootstrapToggle("disable");$("#transacao-fase").val(0);$("#transacao-percentual-fase").val("").prop("readonly",true)}}if(ac==="vi"||ac==="ve"||ac==="ai"||ac==="ae"||ac==="vw"){$("#transacao-is-mudanca").bootstrapToggle(!isAutorizadoAlterar?"disable":"enable");$("#transacao-fase").prop("disabled",!isAutorizadoAlterar).css({"background-color":"white"});$("#transacao-percentual-fase").prop("readonly",!isAutorizadoAlterar)}$("#id-linha-descricao").val(c);$("#transacao-badge-td").html(b[0].quantidadeTD);(Number(b[0].quantidadeTD)>0&&$("#transacao_metodo").val()==3)?$("#transacao_td").val(b[0].quantidadeTD):null;$("#descricao-funcao-td").val("transacao");$("#btn-listar-itens-transacao").prop("disabled",!1);detalheItem(b[0].selImpacto,"transacao");$("#transacao_id_funcao_baseline").val(b[0].idBaseline);if(Number(b[0].idBaseline)>0&&b[0].operacao==="I"&&Number(b[0].situacao)==2&&!(ac==="vw"||ac==="vi"||ac==="ve"||ac==="ai"||ac==="ae"||ac==="re")){swal({title:"Alerta",text:"A fun&ccedil;&atilde;o foi inserida nesta contagem, entretanto j&aacute; foi validada na Baseline. Desta forma n&atilde;o &eacute; poss&iacute;vel realizar as altera&ccedil;&otilde;es aqui. Caso seja uma altera&ccedil;&atilde;o solicitada por um outro projeto ou por este mesmo, inclua um novo item como A - Altera&ccedil;&atilde;o ou E - Exclus&atilde;o.",type:"error",html:true,confirmButtonText:"Entendi!"},function(){autorizaAlteracaoCamposLinha(false,"transacao")})}else{if((abAtual==3||abAtual==4)&&acForms==="al"&&b[0].idGerador>0){swal({title:"Alerta",text:"Esta fun&ccedil;&atilde;o foi inserida pela contagem<br />#ID: <strong>"+("000000"+b[0].idContagem).slice(-6)+"</strong>. Desta forma n&atilde;o &eacute; poss&iacute;vel realizar as altera&ccedil;&otilde;es aqui.",type:"error",html:true,confirmButtonText:"Entendi!"},function(){autorizaAlteracaoCamposLinha(false,"transacao")})}else{$("#transacao_btn_if").prop("disabled",true);$("#transacao_btn_in").prop("disabled",true);$("#transacao_btn_al").prop("disabled",isAutorizadoAlterar?false:true)}}$(".tm-tag-remove").css({visibility:(!isAutorizadoAlterar?"hidden":"visible")});if(ac==="vw"||ac==="vi"||ac==="ve"||ac==="ai"||ac==="ae"){autorizaAlteracaoCamposLinha(false,"transacao")}},"json")}function insereFuncaoTransacao(j){var d=jQuery("#transacao_descricao_ar").tagsManager("tags");var e=jQuery("#transacao_descricao_td").tagsManager("tags");var f=validaFormFuncao("transacao");if(!f.sucesso){swal({title:"Alerta",text:f.msg,type:"error",html:true,confirmButtonText:"Entendi!"},function(){return false});return false}else{var i=$("#transacao-is-mudanca").prop("checked")?1:0;var k=$("#transacao-fase").val();var l=$("#transacao-percentual-fase").val();var g=$("#transacao_operacao").val();var a=$("#transacao_fd").val();var h=$("#id_fator_tecnologia option:selected").val();var c=($("#id_fator_tecnologia option:selected").text()).split("-")[0];$.post("/pf/DIM.Gateway.php",{transacao_operacao:$("#transacao_operacao").val(),transacao_tabela:$("#transacao_tabela").val(),transacao_metodo:$("#transacao_metodo").val(),transacao_entrega:$("#transacao_entrega").val(),transacao_id:idContagem,transacao_qtd_atual:$("#transacao_qtd_atual").val(),transacao_id_roteiro:$("#transacao_id_roteiro").val(),transacao_funcao:(abAtual==2&&(g==="A"||g==="E"||g==="T"))?$("#transacao_funcao").find("option:selected").text().split(" > ")[5]:$("#transacao_funcao").val(),transacao_td:$("#transacao_td").val(),transacao_ar:$("#transacao_ar").val(),transacao_complexidade:$("#transacao_complexidade").val(),transacao_pfb:$("#transacao_pfb").val(),transacao_impacto:$("#transacao_impacto").val(),transacao_pfa:$("#transacao_pfa").val(),transacao_observacoes:$("#transacao_observacoes").val(),transacao_observacoes_validacao:$("#transacao_observacoes_validacao").val(),transacao_fonte:$("#transacao_fonte").val(),transacao_descricao_td:e,transacao_descricao_ar:d,is_mudanca:i,fase_mudanca:k,percentual_fase:l,funcao_id_baseline:(abAtual==2&&(g==="A"||g==="E"||g==="T"))?$("#transacao_funcao").children(":selected").val():0,transacao_fd:a,abrangencia_atual:abAtual,contagem_id_baseline:abAtual==2?$("#contagem_id_baseline").children(":selected").val():0,id_fator_tecnologia:h,valor_fator_tecnologia:c,arq:28,tch:0,sub:-1,dlg:1},function(m){if(Number(m[0].id)>0){var b=document.getElementById("add"+m[0].tabela);var o=b.insertRow(-1);var n=Number(m[0].pfb);var p=Number(m[0].pfa);insereLinha(m[0].id,m[0].tabela,o,m[0].operacao,m[0].funcao,m[0].td,m[0].ar,m[0].complexidade,n.toFixed(4),m[0].siglaFator,p.toFixed(4),m[0].obsFuncao,m[0].situacao,m[0].entrega,0,0,false,i,k,l,a,0,0)}else{swal({title:"Alerta",text:_ERR_INSERCAO,type:"error",html:true,confirmButtonText:"Entendi!"},function(){return false})}},"json");limpaCampos("transacao");return true}}function alteraFuncaoTransacao(j){var f=validaFormFuncao("transacao");var h=situacaoLinha==3?3:(situacaoLinha==4?3:(abAtual==3||abAtual==4?2:1));if(!f.sucesso){swal({title:"Alerta",text:f.msg,type:"error",html:true,confirmButtonText:"Entendi!"});return false}else{var i=$("#transacao-is-mudanca").prop("checked")?1:0;var k=$("#transacao-fase").val();var l=$("#transacao-percentual-fase").val();var a=$("#transacao_fd").val();var g=$("#id_fator_tecnologia option:selected").val();var c=$("#valor_fator_tecnologia").html();var e=jQuery("#transacao_descricao_ar").tagsManager("tags");var d=jQuery("#transacao_descricao_td").tagsManager("tags");$.post("/pf/DIM.Gateway.php",{transacao_operacao:$("#transacao_operacao").val(),transacao_tabela:$("#transacao_tabela").val(),transacao_metodo:$("#transacao_metodo").val(),transacao_entrega:$("#transacao_entrega").val(),transacao_id:$("#transacao_id").val(),transacao_qtd_atual:$("#transacao_qtd_atual").val(),transacao_id_roteiro:$("#transacao_id_roteiro").val(),transacao_funcao:$("#transacao_funcao").val(),transacao_td:$("#transacao_td").val(),transacao_ar:$("#transacao_ar").val(),transacao_complexidade:$("#transacao_complexidade").val(),transacao_pfb:$("#transacao_pfb").val(),transacao_impacto:$("#transacao_impacto").val(),transacao_pfa:$("#transacao_pfa").val(),transacao_observacoes:$("#transacao_observacoes").val(),transacao_observacoes_validacao:$("#transacao_observacoes_validacao").val(),transacao_fonte:$("#transacao_fonte").val(),transacao_descricao_ar:e,transacao_descricao_td:d,is_mudanca:i,fase_mudanca:k,percentual_fase:l,contagem_id_baseline:$("#contagem_id_baseline option:selected").val(),situacao:h,transacao_fd:a,funcao_id_baseline:$("#transacao_id_funcao_baseline").val(),acao_forms:acForms,abrangencia_atual:abAtual,id_contagem:idContagem,id_fator_tecnologia:g,valor_fator_tecnologia:c,arq:7,tch:0,sub:-1,dlg:1},function(p){if(Number(p.id)>0){var q=$("#transacao_qtd_atual").val();var v=p.tabela;var s=Number(p.pfa);var r=Number(p.pfb);var o=Number(p.pfan);var b=Number(p.pfbn);var n=p.obsFuncao;var m=divOperacao(p.operacao);$("#oper_"+v+"_"+q).html(m);$("#funcao_"+v+"_"+q).html(p.funcao);$("#td_"+v+"_"+q).html(p.td);$("#tr_"+v+"_"+q).html(p.tr);$("#complexidade_"+v+"_"+q).html(p.complexidade);$("#pfb_"+v+"_"+q).html(r.toFixed(4));var u="";var w="";if(p.operacao==="A"||p.operacao==="E"){if(p.isMudanca==1){u="<small><br />Retrabalho: "+p.faseMudanca+" - "+p.percentualFase+"%</small>"}}if(Number(a)>0){w=(p.isMudanca?"&nbsp;&nbsp;&nbsp;":"<br />")+"<small>FD: "+parseFloat(a).toFixed(2)+"</small>"}$("#siglaFator_"+v+"_"+q).html(p.siglaFator+(p.isMudanca?u:"")+w);$("#pfa_"+v+"_"+q).html(s.toFixed(4));$("#ent_"+v+"_"+q+"_"+p.id).html(p.entrega);$("#obs_"+v+"_"+q).html(n);setSituacao(h,"cell1_"+v+"_"+$("#transacao_id").val());recalculaEstatisticas(s,r,v,"alterar",o,b,true);swal("Dimension","O registro foi alterado com sucesso!","success");$("#form_modal_funcao_transacao").modal("toggle");limpaCampos("transacao")}else{swal({title:"Alerta",text:p.msg,type:"error",html:true,confirmButtonText:"Entendi!"},function(){$("#form_modal_funcao_transacao").modal("toggle");limpaCampos("transacao")})}},"json")}}$("#chk_pesq_atual").on("change",function(){atualizaItensArquivosReferenciados($(this),"PAT")});$("#chk_pesq_baseline").on("change",function(){atualizaItensArquivosReferenciados($(this),"PAB")});$("#chk_pesq_projeto").on("change",function(){atualizaItensArquivosReferenciados($(this),"PAP")});$("#chk_pesq_avulsa").on("change",function(){atualizaItensArquivosReferenciados($(this),"PAV")});