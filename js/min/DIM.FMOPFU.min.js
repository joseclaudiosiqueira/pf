
var btnClicado;if(abAtual==3||abAtual==4){$("#btn-pesquisar-ali").prop("disabled",true);$("#btn-pesquisar-ee").prop("disabled",true);$("#btn-pesquisar-se").prop("disabled",true);$("#btn-pesquisar-ce").prop("disabled",true)}function changeSelectAIEBaseline(b){if($(b).val()==0){$("#addPesquisaFuncoes").empty()}else{pesquisarFuncoes($("#btn-pesquisar-aie"),$(b).val(),idContagem);var d=$("#contagem_id_baseline").children(":selected").val();var a=$(b).children(":selected").val();var c=$("#btn-pesquisar-aie").val();if(abAtual==2&&d==a&&c==="aie"){$("#opi").prop("disabled",true);$("#opa").prop("disabled",false);$("#ope").prop("disabled",false)}else{if(c==="aie"){$("#opi").prop("disabled",false);$("#opa").prop("disabled",true);$("#ope").prop("disabled",true)}}}}$("#id-baseline-pesquisa-livre").on("change",function(){var a=$(this).children(":selected").val();$("#addPesquisaFuncoesLivre").empty();pesquisarFuncoes(btnClicado,a,idContagem)});$(".btn-pesquisar-funcoes").on("click",function(){btnClicado=$(this);abAtual==1?$("#form-modal-pesquisar-funcoes-livre").modal("show"):$("#form-modal-pesquisar-funcoes").modal("show");if(abAtual==1){var b=$(this).val();$("#div-pesquisa-funcao").html("Selecione ao lado uma Baseline e logo ap&oacute;s selecione os itens que far&atilde;o parte desta Contagem Livre. Voc&ecirc; pode selecionar um ou mais itens, logo ap&oacute;s clique no bot&atilde;o correspondente &agrave; opera&ccedil;&atilde;o que deseja realizar. Caso n&atilde;o haja itens &eacute; porque o sistema n&atilde;o permite duplicidades, verifique se o mesmo j&aacute; est&aacute; na sua contagem.");comboBaseline(0,0,$("#id-baseline-pesquisa-livre"),0)}else{var b=$(this).val();var a=$("#contagem_id_baseline").children(":selected").val();if(abAtual==3||abAtual==4){$("#ope").prop("disabled",true);$("#opa").prop("disabled",true)}else{if(abAtual==2){if(b==="aie"){$("#opa").prop("disabled",true);$("#ope").prop("disabled",true)}else{$("#opi").prop("disabled",true)}}}if(Number(a)<1){swal({title:"Alerta",text:"Para pesquisar este tipo de função [ "+b.toUpperCase()+" ] é necessário que seja uma contagem tipo: <strong>Projeto</strong> e que uma baseline esteja selecionada.",type:"error",html:true})}else{if($(this).val()!=="aie"){$("#div-pesquisa-aie").html("<center><strong>Selecione os itens que far&atilde;o parte desta Contagem de Projeto. Voc&ecirc; pode selecionar um ou mais itens, logo ap&oacute;s clique no bot&atilde;o correspondente &agrave; opera&ccedil;&atilde;o que deseja realizar. Caso n&atilde;o haja itens &eacute; porque o sistema n&atilde;o permite duplicidades, verifique se o mesmo j&aacute; est&aacute; na sua contagem.</strong></center>");pesquisarFuncoes($(this),a,idContagem)}else{$("#div-pesquisa-aie").html('<label for="id-baseline-pesquisa">Para pesquisar ALIs e inserir como AIEs nesta baseline, selecione a qual baseline os ALIs se referem</label><select id="id-baseline-pesquisa" class="form-control input_style" onchange="changeSelectAIEBaseline($(this));"></select>');comboBaselineAIE("ali",a,abAtual)}}}});$("#form-modal-pesquisar-funcoes").on("hide.bs.modal",function(a){$("#addPesquisaFuncoes").empty();$("#opi").prop("disabled",false);$("#opa").prop("disabled",false);$("#ope").prop("disabled",false);funcoesItems=[]});$("#form-modal-pesquisar-funcoes-livre").on("hide.bs.modal",function(a){$("#addPesquisaFuncoesLivre").empty();$("#opi").prop("disabled",false);$("#opa").prop("disabled",false);$("#ope").prop("disabled",false);funcoesItems=[]});$(".btn-adicionar-funcoes").on("click",function(){var a=$(this).val();if(funcoesItems.length<1){swal({title:"Alerta",text:"Voc&ecirc; precisa selecionar ao menos uma fun&ccedil;&atilde;o de Dados/Transa&ccedil;&atilde;o.",type:"warning",html:true,confirmButtonText:"Entendi, obrigado!"})}else{$.post("/pf/DIM.Gateway.php",{fi:funcoesItems,abAtual:abAtual,idContagem:idContagem,idBaseline:abAtual==1?$("#id-baseline-pesquisa-livre").children(":selected").val():$("#id-baseline-pesquisa").children(":selected").val(),idBaselineContagem:abAtual==1?$("#id-baseline-pesquisa-livre").children(":selected").val():$("#contagem_id_baseline").children(":selected").val(),operacao:a,arq:30,tch:0,sub:-1,dlg:1},function(b){if(b.status){tabela=b.tabela;listaFuncao(idContagem,tabela,$("#add"+tabela.toUpperCase())[0],b.funcao,"id","ASC");swal({title:"Informa&ccedil;&atilde;o",text:"As funcionalidades selecionadas foram inseridas com sucesso nesta contagem.",type:"success",html:true,confirmButtonText:"Ok, obrigado!"})}else{swal({title:"Alerta",text:"Houve um erro durante a inser&ccedil;&atilde;o das funcionalidades na contagem, por favor procure por um Gestor.",type:"error",html:true,confirmButtonText:"Obrigado, vou verificar!"})}abAtual==1?$("#form-modal-pesquisar-funcoes-livre").modal("hide"):$("#form-modal-pesquisar-funcoes").modal("hide")},"json")}});function pesquisarFuncoes(c,f,a){var e=$(c).val()==="aie"&&abAtual==3?"ali-aie":$(c).val();var d=abAtual==1?f:$("#contagem_id_baseline").children(":selected").val();$.post("/pf/DIM.Gateway.php",{t:e,i:f,b:d,ic:a,ab:abAtual,arq:abAtual==1?88:(abAtual==3?75:76),tch:1,sub:5,dlg:1},function(i){if(i.length>0){var g=$(abAtual==1?"#addPesquisaFuncoesLivre":"#addPesquisaFuncoes").get(0);var b;var h;divRowFuncao=document.createElement("div");divRowFuncao.className="row well well-sm";divRowFuncao.style.paddingLeft="40px";divRowFuncao.style.lineHeight="38px";divColFuncao=document.createElement("div");divColTD=document.createElement("div");divColTR=document.createElement("div");divColPfb=document.createElement("div");divColOperacao=document.createElement("div");divColDataCadastro=document.createElement("div");divColAtualizadoPor=document.createElement("div");divColFuncao.className="col-md-3";divColTD.className="col-md-1";divColTR.className="col-md-1";divColPfb.className="col-md-1";divColOperacao.className="col-md-1";divColDataCadastro.className="col-md-1";divColAtualizadoPor.className="col-md-4";divColFuncao.innerHTML="Função";divColTD.innerHTML="TD";divColTR.innerHTML=e==="ali-aie"||e==="ali"?"TR":"AR";divColPfb.innerHTML="PFb";divColOperacao.innerHTML="Oper.";divColDataCadastro.innerHTML="Cadastro";divColAtualizadoPor.innerHTML="Atualizado por";divRowFuncao.appendChild(divColFuncao);divRowFuncao.appendChild(divColTD);divRowFuncao.appendChild(divColTR);divRowFuncao.appendChild(divColPfb);divRowFuncao.appendChild(divColOperacao);divRowFuncao.appendChild(divColDataCadastro);divRowFuncao.appendChild(divColAtualizadoPor);g.appendChild(divRowFuncao);for(x=0;x<i.length;x++){divRowFuncao=document.createElement("div");divRowFuncao.className="row";divRowFuncao.style.paddingLeft="40px";divRowFuncao.style.lineHeight="38px";divColFuncao=document.createElement("div");divColTD=document.createElement("div");divColTR=document.createElement("div");divColPfb=document.createElement("div");divColOperacao=document.createElement("div");divColDataCadastro=document.createElement("div");divColAtualizadoPor=document.createElement("div");divColFuncao.className="col-md-3";divColTD.className="col-md-1";divColTR.className="col-md-1";divColPfb.className="col-md-1";divColOperacao.className="col-md-1";divColDataCadastro.className="col-md-1";divColAtualizadoPor.className="col-md-4";divRowFuncao.appendChild(divColFuncao);divRowFuncao.appendChild(divColTD);divRowFuncao.appendChild(divColTR);divRowFuncao.appendChild(divColPfb);divRowFuncao.appendChild(divColOperacao);divRowFuncao.appendChild(divColDataCadastro);divRowFuncao.appendChild(divColAtualizadoPor);g.appendChild(divRowFuncao);b=document.createElement("input");b.setAttribute("onclick","insereIdBaseline($(this));");b.setAttribute("type","checkbox");b.className="css-checkbox";b.id=(c==="aie"?c:$(c).val())+"-"+("000000000"+i[x].id).slice(-9);h=document.createElement("label");h.className="css-label-check";h.setAttribute("for",(c==="aie"?c:$(c).val())+"-"+("000000000"+i[x].id).slice(-9));h.innerHTML=("000000000"+i[x].id).slice(-9)+" - "+i[x].funcao;divColFuncao.appendChild(b);divColFuncao.appendChild(h);divColPfb.innerHTML="<strong>PFb</strong>: "+parseFloat(i[x].pfb).toFixed(3);divColTD.innerHTML="<strong>TD</strong>: "+("0000"+i[x].td).slice(-4);divColTR.innerHTML="<strong>"+(e==="ali-aie"||e==="ali"?"TR":"AR")+"</strong>: "+("0000"+i[x].tr).slice(-4);divColOperacao.innerHTML=divOperacao(i[x].operacao);divColDataCadastro.innerHTML=formattedDate(i[x].data_cadastro,false,false);divColAtualizadoPor.innerHTML=i[x].atualizado_por}}else{if(f>0){swal({title:"Alerta",text:"N&atilde;o h&aacute; "+(c==="aie"?arrFuncoes.ali+" cadastrados(as) em outras Baselines, ":arrFuncoes[$(c).val()]+" cadastrados(as) nesta Baseline, ")+"ou se h&aacute;, ainda n&atilde;o est&atilde;o validados(as). Verifique se a funcionalidade que voc&ecirc; est&aacute; pesquisando j&aacute; est&aacute; inclu&iacute;da na Contagem, evitando duplicidades.",type:"warning",html:true,confirmButtonText:"Entendi, obrigado!"})}}},"json")}function insereIdBaseline(a){$(a).prop("checked")?funcoesItems.push($(a).get(0).id):funcoesItems.splice(funcoesItems.indexOf($(a).get(0).id),1)};